window.Utility={};window.Utility.autoSelectRenderer=function(){var b=navigator.userAgent;return/iP(ad|hone|od).*OS 4/.test(b)||/Android 2\.1/.test(b)||/Android 4/.test(b)&&!/Chrome/.test(b)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(b){var v=["log","warn","error"],h=b.console.log,n=b.console.warn,x=b.console.error,s={log:function(){if(b.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var k="",n=["privateData","data","url","width","height"],a=0;a<arguments.length;a++){var m="",f;for(f in arguments[a])-1!==n.indexOf(f)&&(m+=f+"="+arguments[a][f]+"\n");k+=m}arguments[0]=arguments[0].replace(/%o/,k)}return h.apply(b.console,arguments)}},warn:function(){if(b.LWFLOADER_ENABLE_DEBUG)return n.apply(b.console,
arguments)},error:function(){if(b.LWFLOADER_ENABLE_DEBUG)return x.apply(b.console,arguments)}},k,z,r;k=0;for(z=v.length;k<z;++k)r=v[k],b.console[r]=s[r]})(window);
(function(b){function v(a){a="useCanvasRenderer"===a||"useWebGLRenderer"===a?document.createElement("canvas"):document.createElement("div");a.width=a.height=0;return a}function h(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;this.backgroundColor=null;this.resizeMode="fitForWidth";this.displayDivId=this.resizeStretch=null;this.stageHeight=this.stageWidth=this.heightLimit=this.widthLimit=0;this.stageVAlign=this.stageHAlign=-1;this.useLargeImage=!1;this.rootOffset=
{x:0,y:0};var a=null,b=0;this.getRenderer=function(){return a};this.setRenderer=function(f){if(a)throw Error("cannot use multiple renderer! LWF has been initialized for "+a+" renderer.");"canvas"===f?f="useCanvasRenderer":"webkitcss"===f?f="useWebkitCSSRenderer":"webgl"===f&&(f="useWebGLRenderer");f&&f.match(/use.+Renderer/i)&&(a=f)};this.getCurrentFPS=function(){isNaN(b)&&console.error("[LWF] FPS is not properly defined");return b};this.setCurrentFPS=function(a){isNaN(a)&&console.error("[LWF] FPS is not properly defined");
b=a};return this}var n=navigator.userAgent,x=/iP(ad|hone|od)/.test(n),s=/Android/.test(n),k=x||s,z=/Chrome/.test(n),r=!s||z,C=x||/Android *(4|3)\..*/.test(n),y=0;"undefined"===typeof b.performance&&(b.performance={});b.performance.now=b.performance.now||b.performance.webkitNow||b.performance.mozNow||b.performance.oNow||b.performance.msNow||Date.now;b.requestAnimationFrame=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame;
(void 0===b.requestAnimationFrame||/iP(ad|hone|od).*OS 6/.test(n))&&function(){var a=1E3/60,m=b.performance.now();b.requestAnimationFrame=function(f){var e=b.performance.now()-m;return b.setTimeout(function(){m=b.performance.now();f()},a-(e>a?e%a:e))}}();h.prototype.isLwfsEnvironment_=function(){return b.testlwf_settings};h.prototype.addInitializeHook=function(a){_.isFunction(a)&&this.initializeHooks.push(a)};h.prototype.pause=function(){this.pausing=!0};h.prototype.resume=function(){this.pausing=
!1};h.prototype.getLwfMapper_=function(a){if(null===a.lwfMap)return _.bind(this.getLwfPath_,this);var b=a.lwfMap;if(_.isObject(b))return _.isFunction(b)?b:function(a){var e=a;b.hasOwnProperty(a)&&(e=b[a]);/\.lwf$/.test(e)||(e+=".lwf");return e};throw Error("unsupported lwfMap");};h.prototype.getLwfPath_=function(a){var b=a;0<=a.indexOf("/")&&(b=a.substring(a.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?b+".lwf":a+"/_/"+b+".lwf"};h.prototype.getImageMapper_=function(a){return _.isFunction(a)?
a:function(b){return a[b]?a[b]:b}};h.prototype.setDisplaySetting=function(a){a.renderer&&this.setRenderer(a.renderer);this.resizeMode=a.resizeMode||this.resizeMode;this.resizeStretch=a.resizeStretch||this.resizeStretch;this.displayDivId=a.displayDivId||this.displayDivId;this.widthLimit=a.widthLimit||this.widthLimit;this.heightLimit=a.heightLimit||this.heightLimit;this.stageWidth=a.stageWidth||this.stageWidth;this.stageHeight=a.stageHeight||this.stageHeight;this.stageHAlign=a.stageHAlign||this.stageHAlign;
this.stageVAlign=a.stageVAlign||this.stageVAlign;this.useLargeImage=a.useLargeImage||this.useLargeImage};h.prototype.handleException_=function(a,b){var f=b.pageTransitionMap,e=null;f.hasOwnProperty("error")?e=f.error:0<_.size(f)&&(e=_.find(f,function(){return!0}));f=b.handler;null===f||void 0===f.exception?confirm("LWF exception. \n"+a.stack+"\n reload?")&&location.reload():_.isFunction(f.exception)&&f.exception(a,e);console.error("[LWF] exception: %s",a.stack)};h.prototype.handleLoadError_=function(a,
b){var f=b.pageTransitionMap,e=null;f.hasOwnProperty("error")?0<_.size(f)&&(e=_.find(f,function(){return!0})):e=f.error;f=b.handler;null===f||void 0===f.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(f.loadError)&&f.loadError(a,e);console.error("[LWF] load error: %o",a.error);console.error("[LWF] loaded count: %d/%d",a.loadedCount,a.total)};h.prototype.onLoad=function(a){var m=this,f=m.privateData._loaderData,e=f.loader,c=f.stageEventReceiver;m.privateData=null;if(a){if(_.isFunction(f.callback.onLoad))f.callback.onLoad(a);
var g,d,i,h,D,l=this.stage,r=0,v=0,w=1,t=0,u=0,E=b.performance.now(),F=0,y=E,G=0;a.rootMovie.moveTo(e.rootOffset.x,e.rootOffset.y);g=function(){try{if(a){var d=b.devicePixelRatio;"useWebkitCSSRenderer"===e.getRenderer()&&(d=1);var p=e.stageWidth?e.stageWidth:a.width,q=e.stageHeight?e.stageHeight:a.height,h=b.innerWidth,i=b.innerHeight;s&&(b.innerWidth>b.screen.width&&(h=b.screen.width),b.innerHeight>b.screen.height&&(i=b.screen.height));if(p>h||f.resizeStretch)p=h;if(q>i||f.resizeStretch)q=i;if(r!==
p||v!==q)if(r=p,v=q,m.fitForWidth?(m.widthLimit&&(p=p>m.widthLimit?m.widthLimit:p),t=Math.round(p),u=Math.round(p*a.height/a.width)):(m.heightLimit&&(q=q>m.heightLimit?m.heightLimit:q),t=Math.round(q*a.width/a.height),u=Math.round(q)),i=h=0,h=-1==e.stageHAlign?0:1==e.stageHAlign?Math.round(p-t):Math.round((p-t)/2),i=-1==e.stageVAlign?0:1==e.stageVAlign?Math.round(q-u):Math.round((q-u)/2),c.style.left=l.style.left=h+"px",c.style.top=l.style.top=i+"px",c.style.width=l.style.width=t+"px",c.style.height=
l.style.height=u+"px",c.width=l.width=Math.floor(t*d),c.height=l.height=Math.floor(u*d),m.fitForWidth?(w=t/l.width,a.property.clear(),a.fitForWidth(l.width,l.height)):(w=u/l.height,a.property.clear(),a.fitForHeight(l.width,l.height)),e.displayDivId){var k=document.getElementById(e.displayDivId);k.style.width=t+"px";k.style.height=u+"px"}var j=b.performance.now(),d=j-E;E=j;e.pausing||(a.exec(d/1E3),a.render());b.requestAnimationFrame(g);0===F%60&&(G=Math.round(6E4/(j-y)),y=j,F=0);if(e.debug||f.debug)document.getElementById("lwf_info"+
f.debugInfoElementId).innerHTML=G+"fps";F++;e.setCurrentFPS(G)}}catch(n){e.handleException_(n,f)}};d=function(c){try{if(C&&c.preventDefault(),a){var b,d,g=l.getBoundingClientRect();if(k){var h=c.touches[0];b=h.pageX;d=h.pageY}else b=c.clientX,d=c.clientY;k?(b-=l.offsetLeft,d-=l.offsetTop,b=b-g.left-window.scrollX,d=d-g.top-window.scrollY):(b-=g.left,d-=g.top);b/=w;d/=w;a.inputPoint(b,d)}}catch(i){e.handleException_(i,f)}};i=function(c){try{if(C&&c.preventDefault(),a){var b,d,g=l.getBoundingClientRect();
if(k){var h=c.touches[0];b=h.pageX;d=h.pageY}else b=c.clientX,d=c.clientY;k?(b-=l.offsetLeft,d-=l.offsetTop,b=b-g.left-window.scrollX,d=d-g.top-window.scrollY):(b-=g.left,d-=g.top);b/=w;d/=w;a.inputPoint(b,d);a.inputPress()}}catch(i){e.handleException_(i,f)}};h=function(c){try{C&&c.preventDefault(),a&&a.inputRelease()}catch(b){e.handleException_(b,f)}};D=function(c){try{a&&b.location.reload(!0)}catch(d){e.handleException_(d,f)}};b.requestAnimationFrame(g);k?(s&&(z||/ SC-0/.test(n))&&document.body.addEventListener("touchstart",
function(){}),x&&(e.debug||f.debug)&&c.addEventListener("gestureend",D,!1),c.addEventListener("touchmove",d,!1),c.addEventListener("touchstart",i,!1),c.addEventListener("touchend",h,!1)):(c.addEventListener("mousemove",d,!1),c.addEventListener("mousedown",i,!1),c.addEventListener("mouseup",h,!1));_.each(f.buttonEventMap,function(c,b){_.isFunction(c)?c={release:c}:_.each(c,function(a,c){if(!_.isFunction(a))throw Error("button event ["+c+"@"+b+"] is not a function!");});a.setButtonEventHandler(b,c)});
var A={},B=function(a,c){A.hasOwnProperty(a)||(A[a]=[]);A[a].push(c)};_.isObject(f.fsCommandMap)&&_.each(f.fsCommandMap,function(a,c){_.isFunction(a)&&B(c,a)});_.isObject(f.pageTransitionMap)&&_.each(f.pageTransitionMap,function(a,c){_.isString(a)?B(c,function(){document.location.href=a}):_.isFunction(a)&&B(c,function(){a(c)})});B=null;_.each(A,function(c,b){a.setEventHandler(b,function(a,b){for(var d=c.length,e=0;e<d;++e)c[e](a,b)})});A=null}else e.handleLoadError_(this,f)};h.prototype.playLWF=function(a,
h){var f=a.getAttribute("data-lwf-display_setting");f&&(f=JSON.parse(f),this.setDisplaySetting(f));f=b.LWF;this.getRenderer()||this.setRenderer(b.Utility.autoSelectRenderer());var e=this.getRenderer();if(e)f[e]();else throw Error("Renderer parameters are not properly set");f=f.ResourceCache.get();this.debug&&(b.LWFLOADER_ENABLE_DEBUG=!0);var c={};c.onload=this.onLoad;this.backgroundColor?c.setBackgroundColor=this.backgroundColor:c.useBackgroundColor=!0;c.fitForHeight=!1;c.fitForWidth=!1;"fitForWidth"===
this.resizeMode?c.fitForWidth=!0:"fitForHeight"===this.resizeMode&&(c.fitForHeight=!0);c.resizeStretch=this.resizeStretch;c.widthLimit=this.widthLimit;c.heightLimit=this.heightLimit;c.worker=r;s&&(/ (SC-0|Galaxy Nexus)/.test(n)&&"useWebkitCSSRenderer"===e)&&(c.quirkyClearRect=!0);s&&(c.use3D=!1);c.privateData={};c.pos=null;c.imageMap={};c.soundMap={};c.pageTransitionMap={};c.buttonEventMap={};c.fsCommandMap={};c.handler={};c.callback={};c.lwfMap=null;for(var g=function(a){return a.charAt(1).toUpperCase()},
d=0;d<a.attributes.length;d++){var i=a.attributes[d];if(i.name&&0===i.name.indexOf("data-lwf-")){var j=i.name.slice(9),j=j.replace(/_./g,g);if("displaySetting"!==j){i=i.value;try{"{"===i.charAt(0)&&(i=JSON.parse(i))}catch(D){}c[j]=i}}}2===b.devicePixelRatio&&this.useLargeImage&&(c.imageSuffix="_@2x");c.hasOwnProperty("lwf")||(g=a.getAttribute("data-lwf"),_.isString(g)&&(c.lwf=g));c.hasOwnProperty("name")&&(c.lwf=c.name);_.isObject(h)&&_.extend(c,h);0<this.initializeHooks.length&&_.each(this.initializeHooks,
_.bind(function(b){if(_.isFunction(b)){b=b.call(this,a);for(var d in b)b.hasOwnProperty(d)&&_.extend(c[d],b[d])}},this));this.initializeHooks=[];if(!c.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");g={};g.debugInfoElementId=++y;g.setting=c;g.loader=this;g.debug=!1;g.soundMap=null;g.pageTransitionMap=null;g.buttonEventMap=null;g.fsCommandMap=null;g.handler=null;g.callback=null;g.stageEventReceiver=null;g.lwfMap=null;g.debug=this.debug;c.privateData.hasOwnProperty("lwfLoader")||(c.privateData.lwfLoader=
this);c.imageMap=this.getImageMapper_(c.imageMap);_.isEmpty(c.soundMap)||(g.soundMap=c.soundMap);delete c.soundMap;_.isObject(c.pageTransitionMap)&&(g.pageTransitionMap=c.pageTransitionMap);delete c.pageTransitionMap;g.buttonEventMap=c.buttonEventMap;delete c.buttonEventMap;_.isEmpty(c.fsCommandMap)||(g.fsCommandMap=c.fsCommandMap);delete c.fsCommandMap;_.isEmpty(c.handler)||(g.handler=c.handler);delete c.handler;g.callback=c.callback;delete c.callback;g.lwfMap=c.lwfMap;delete c.lwfMap;g.resizeStretch=
c.resizeStretch;delete c.resizeStretch;this.isLwfsEnvironment_()&&(d=c.prefix?c.prefix+c.lwf:c.lwf,c.prefix=d.slice(0,d.lastIndexOf("/")+1),delete c.imagePrefix,c.lwf=d.slice(d.lastIndexOf("/")+1));d={position:"absolute",top:0,left:0};_.extend(d,c.pos);delete c.pos;if("static"===a.style.position||""===a.style.position)a.style.position="relative";e=v(e);e.style.position=d.position;e.style.top=d.top+"px";e.style.left=d.left+"px";e.style.zIndex=a.style.zIndex+1;a.appendChild(e);j=null;k?(j=document.createElement("div"),
j.style.position="absolute",j.style.top=d.top+"px",j.style.left=d.left+"px",j.style.zIndex=e.style.zIndex+1,a.appendChild(j)):j=e;c.stage=e;g.stageEventReceiver=j;if(this.debug||g.debug)e=document.createElement("div"),e.id="lwf_info"+y,e.style.position=d.position,e.style.top=d.top+"px",e.style.left=d.left+"px",e.style.color="white",e.style.zIndex=1E4,a.appendChild(e);if(c.lwf){g.useLwfJs=/\.lwf.js(\?.*)?$/.test(c.lwf);if(c.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");
c.privateData._loaderData=g;f.loadLWF(c)}else console.error("[LWF] no LWF input")};h.prototype.requestLWF_=function(a,b,f,e,c){var g={};if(this.isLwfsEnvironment_()){var d=_.clone(window.testlwf_settings);d.prefix?g=d.prefix+b+"/_/":(g=document.location.pathname,g=g.replace(a.name,b),g=g.slice(0,g.lastIndexOf("/")+1)+"_/");d.prefix=g;delete d.imagePrefix;g=this.getLwfPath_(b);if(!g)return console.error("[LWF] no LWF input"),c("no LWF input",null),null;d.lwf=g;s&&(d.lwf+=".js");d.parentLWF=a;d.stage=
a.stage;d.worker=r;d.active=!1;f&&(d.imageMap=this.getImageMapper_(f));e&&(d.privateData=e);d.onload=function(a){var b=this.privateData.lwfLoader;return!a?(b.handleLoadError_(this),c(this.error,a)):c(null,a)}}else{d=a.privateData;if("undefined"===typeof d)return console.error("[LWF] Parent private data is not found"),c("no parents data found",null),null;var h=_.clone(d._loaderData);if("undefined"===typeof h)return console.error("[LWF] Parent Loader data is not found"),c("no loader parameters to inherit"),
null;d=_.clone(h.setting);d.fitForHeight=d.fitForWidth=!1;h.setting=d;g=null;try{g=this.getLwfMapper_(h)(b)}catch(j){this.handleException_(j,h)}if(!g)return console.error("[LWF] no LWF input"),c("no LWF input",null),null;d.lwf=g;h.useLwfJs&&(d.lwf+=".js");d.parentLWF=a;d.stage=a.stage;d.worker=r;d.active=!1;f&&(d.imageMap=this.getImageMapper_(f));e&&(e._loaderData=h,d.privateData=e,e.prefix&&(d.prefix=e.prefix),e.imagePrefix&&(d.imagePrefix=e.imagePrefix));d.onload=function(a){var b=h.loader;return!a?
(b.handleLoadError_(this,h),c(this.error,a)):c(null,a)}}return d};h.prototype.requestLWF=function(a,b,f,e,c){a=this.requestLWF_(a,b,f,e,c);_.isNull(a)||this.requests.push(a)};h.prototype.loadLWF=function(a,h,f,e,c){a=this.requestLWF_(a,h,f,e,c);_.isNull(a)||b.LWF.ResourceCache.get().loadLWF(a)};h.prototype.loadLWFs=function(a){b.LWF.ResourceCache.get().loadLWFs(this.requests,a);this.requests=[]};b.LwfLoader=h})(window);
