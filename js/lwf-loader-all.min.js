window.Utility={};window.Utility.autoSelectRenderer=function(){var b=navigator.userAgent;return/Android 2\.1/.test(b)||/Android 4/.test(b)&&!/Chrome/.test(b)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(b){var s=["log","warn","error"],h=b.console.log,k=b.console.warn,A=b.console.error,p={log:function(){if(b.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var k="",m=["privateData","data","url","width","height"],a=0;a<arguments.length;a++){var i="",e;for(e in arguments[a])-1!==m.indexOf(e)&&(i+=e+"="+arguments[a][e]+"\n");k+=i}arguments[0]=arguments[0].replace(/%o/,k)}return h.apply(b.console,arguments)}},warn:function(){if(b.LWFLOADER_ENABLE_DEBUG)return k.apply(b.console,
arguments)},error:function(){if(b.LWFLOADER_ENABLE_DEBUG)return A.apply(b.console,arguments)}},m,y,n;m=0;for(y=s.length;m<y;++m)n=s[m],b.console[n]=p[n]})(window);
(function(b){function s(a){a="useCanvasRenderer"===a||"useWebGLRenderer"===a?document.createElement("canvas"):document.createElement("div");a.width=a.height=0;return a}function h(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;this.backgroundColor=null;this.resizeMode="fitForWidth";this.displayDivId=this.resizeStretch=null;this.heightLimit=this.widthLimit=0;this.useLargeImage=!1;this.rootOffset={x:0,y:0};var a=null,b=0;this.getRenderer=function(){return a};
this.setRenderer=function(e){if(a)throw Error("cannot use multiple renderer! LWF has been initialized for "+a+" renderer.");"canvas"===e?e="useCanvasRenderer":"webkitcss"===e?e="useWebkitCSSRenderer":"webgl"===e&&(e="useWebGLRenderer");e&&e.match(/use.+Renderer/i)&&(a=e)};this.getCurrentFPS=function(){isNaN(b)&&console.error("[LWF] FPS is not properly defined");return b};this.setCurrentFPS=function(a){isNaN(a)&&console.error("[LWF] FPS is not properly defined");b=a};return this}var k=navigator.userAgent,
A=/iPhone/.test(k)||/iPod/.test(k)||/iPad/.test(k),p=/Android/.test(k),m=A||p,y=/Chrome/.test(k),n=!p||y,C=/(iPhone|iPad)/.test(k)||/Android *(4|3)\..*/.test(k),x=0;"undefined"===typeof b.performance&&(b.performance={});b.performance.now=b.performance.now||b.performance.webkitNow||b.performance.mozNow||b.performance.oNow||b.performance.msNow||Date.now;b.requestAnimationFrame=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame;
(void 0===b.requestAnimationFrame||/iP(ad|hone|od).*OS 6/.test(k))&&function(){var a=1E3/60,i=b.performance.now();b.requestAnimationFrame=function(e){var f=b.performance.now()-i;return b.setTimeout(function(){i=b.performance.now();e()},a-(f>a?f%a:f))}}();h.prototype.isLwfsEnvironment_=function(){return b.testlwf_settings};h.prototype.addInitializeHook=function(a){_.isFunction(a)&&this.initializeHooks.push(a)};h.prototype.pause=function(){this.pausing=!0};h.prototype.resume=function(){this.pausing=
!1};h.prototype.getLwfMapper_=function(a){if(null===a.lwfMap)return _.bind(this.getLwfPath_,this);var b=a.lwfMap;if(_.isObject(b))return _.isFunction(b)?b:function(a){var f=a;b.hasOwnProperty(a)&&(f=b[a]);/\.lwf$/.test(f)||(f+=".lwf");return f};throw Error("unsupported lwfMap");};h.prototype.getLwfPath_=function(a){var b=a;0<=a.indexOf("/")&&(b=a.substring(a.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?b+".lwf":a+"/_/"+b+".lwf"};h.prototype.getImageMapper_=function(a){return _.isFunction(a)?
a:function(b){return a[b]?a[b]:b}};h.prototype.setDisplaySetting=function(a){a.renderer&&this.setRenderer(a.renderer);this.resizeMode=a.resizeMode||this.resizeMode;this.resizeStretch=a.resizeStretch||this.resizeStretch;this.displayDivId=a.displayDivId||this.displayDivId;this.widthLimit=a.widthLimit||this.widthLimit;this.heightLimit=a.heightLimit||this.heightLimit;this.useLargeImage=a.useLargeImage||this.useLargeImage};h.prototype.handleException_=function(a,b){var e=b.pageTransitionMap,f=null;e.hasOwnProperty("error")?
f=e.error:0<_.size(e)&&(f=_.find(e,function(){return!0}));e=b.handler;null===e||void 0===e.exception?confirm("LWF exception. \n"+a.stack+"\n reload?")&&location.reload():_.isFunction(e.exception)&&e.exception(a,f);console.error("[LWF] exception: %s",a.stack)};h.prototype.handleLoadError_=function(a,b){var e=b.pageTransitionMap,f=null;e.hasOwnProperty("error")?0<_.size(e)&&(f=_.find(e,function(){return!0})):f=e.error;e=b.handler;null===e||void 0===e.loadError?confirm("LWF load error. \n reload?")&&
location.reload():_.isFunction(e.loadError)&&e.loadError(a,f);console.error("[LWF] load error: %o",a.error);console.error("[LWF] loaded count: %d/%d",a.loadedCount,a.total)};h.prototype.onLoad=function(a){var i=this,e=i.privateData._loaderData,f=e.loader,c=e.stageEventReceiver;i.privateData=null;if(a){if(_.isFunction(e.callback.onLoad))e.callback.onLoad(a);var g,d,t,h,D,l=this.stage,n=0,s=0,u=1,v=0,w=0,E=b.performance.now(),F=0,x=E,G=0;a.rootMovie.moveTo(f.rootOffset.x,f.rootOffset.y);g=function(){try{if(a){var d=
b.devicePixelRatio;"useWebkitCSSRenderer"===f.getRenderer()&&(d=1);var q=a.width,r=a.height,h=b.innerWidth,t=b.innerHeight;p&&(b.innerWidth>b.screen.width&&(h=b.screen.width),b.innerHeight>b.screen.height&&(t=b.screen.height));if(q>h||e.resizeStretch)q=h;if(r>t||e.resizeStretch)r=t;if(n!==q||s!==r)if(i.fitForWidth?(i.widthLimit&&(q=q>i.widthLimit?i.widthLimit:q),v=Math.round(q),w=Math.round(q*a.height/a.width)):(i.heightLimit&&(r=r>i.heightLimit?i.heightLimit:r),v=Math.round(r*a.width/a.height),w=
Math.round(r)),c.style.width=l.style.width=v+"px",c.style.height=l.style.height=w+"px",c.width=l.width=Math.floor(v*d),c.height=l.height=Math.floor(w*d),i.fitForWidth?(u=v/l.width,a.property.clear(),a.fitForWidth(l.width,l.height)):(u=w/l.height,a.property.clear(),a.fitForHeight(l.width,l.height)),n=q,s=r,f.displayDivId){var k=document.getElementById(f.displayDivId);k.style.width=v+"px";k.style.height=w+"px"}var j=b.performance.now(),d=j-E;E=j;f.pausing||(a.exec(d/1E3),a.render());b.requestAnimationFrame(g);
0===F%60&&(G=Math.round(6E4/(j-x)),x=j,F=0);if(f.debug||e.debug)document.getElementById("lwf_info"+e.debugInfoElementId).innerHTML=G+"fps";F++;f.setCurrentFPS(G)}}catch(m){f.handleException_(m,e)}};d=function(c){try{if(C&&c.preventDefault(),a){var b,d,g=l.getBoundingClientRect();if(m){var i=c.touches[0];b=i.pageX;d=i.pageY}else b=c.clientX,d=c.clientY;m?(b-=l.offsetLeft,d-=l.offsetTop,b=b-g.left-window.scrollX,d=d-g.top-window.scrollY):(b-=g.left,d-=g.top);b/=u;d/=u;a.inputPoint(b,d)}}catch(h){f.handleException_(h,
e)}};t=function(c){try{if(C&&c.preventDefault(),a){var b,d,g=l.getBoundingClientRect();if(m){var i=c.touches[0];b=i.pageX;d=i.pageY}else b=c.clientX,d=c.clientY;m?(b-=l.offsetLeft,d-=l.offsetTop,b=b-g.left-window.scrollX,d=d-g.top-window.scrollY):(b-=g.left,d-=g.top);b/=u;d/=u;a.inputPoint(b,d);a.inputPress()}}catch(h){f.handleException_(h,e)}};h=function(c){try{C&&c.preventDefault(),a&&a.inputRelease()}catch(b){f.handleException_(b,e)}};D=function(c){try{a&&b.location.reload(!0)}catch(d){f.handleException_(d,
e)}};b.requestAnimationFrame(g);m?(p&&(y||/ SC-0/.test(k))&&document.body.addEventListener("touchstart",function(){}),A&&(f.debug||e.debug)&&c.addEventListener("gestureend",D,!1),c.addEventListener("touchmove",d,!1),c.addEventListener("touchstart",t,!1),c.addEventListener("touchend",h,!1)):(c.addEventListener("mousemove",d,!1),c.addEventListener("mousedown",t,!1),c.addEventListener("mouseup",h,!1));_.each(e.buttonEventMap,function(c,b){_.isFunction(c)?c={release:c}:_.each(c,function(a,c){if(!_.isFunction(a))throw Error("button event ["+
c+"@"+b+"] is not a function!");});a.setButtonEventHandler(b,c)});var z={},B=function(a,c){z.hasOwnProperty(a)||(z[a]=[]);z[a].push(c)};_.isObject(e.fsCommandMap)&&_.each(e.fsCommandMap,function(a,c){_.isFunction(a)&&B(c,a)});_.isObject(e.pageTransitionMap)&&_.each(e.pageTransitionMap,function(a,c){_.isString(a)?B(c,function(){document.location.href=a}):_.isFunction(a)&&B(c,function(){a(c)})});B=null;_.each(z,function(c,b){a.setEventHandler(b,function(a,b){for(var d=c.length,e=0;e<d;++e)c[e](a,b)})});
z=null}else f.handleLoadError_(this,e)};h.prototype.playLWF=function(a,i){var e=a.getAttribute("data-lwf-display_setting");e&&(e=JSON.parse(e),this.setDisplaySetting(e));e=b.LWF;this.getRenderer()||this.setRenderer(b.Utility.autoSelectRenderer());var f=this.getRenderer();if(f)e[f]();else throw Error("Renderer parameters are not properly set");e=e.ResourceCache.get();this.debug&&(b.LWFLOADER_ENABLE_DEBUG=!0);var c=_.isObject(b.lwfDefaultParam)?_.clone(b.lwfDefaultParam):{};c.onload=this.onLoad;this.backgroundColor?
c.setBackgroundColor=this.backgroundColor:c.useBackgroundColor=!0;c.fitForHeight=!1;c.fitForWidth=!1;"fitForWidth"===this.resizeMode?c.fitForWidth=!0:"fitForHeight"===this.resizeMode&&(c.fitForHeight=!0);c.resizeStretch=this.resizeStretch;c.widthLimit=this.widthLimit;c.heightLimit=this.heightLimit;c.worker=n;p&&(/ SC-0/.test(k)&&"useWebkitCSSRenderer"===f)&&(c.quirkyClearRect=!0);p&&(c.use3D=!1);c.privateData={};c.pos=null;c.imageMap={};c.soundMap={};c.pageTransitionMap={};c.buttonEventMap={};c.fsCommandMap=
{};c.handler={};c.callback={};c.lwfMap=null;for(var g=function(a){return a.charAt(1).toUpperCase()},d=0;d<a.attributes.length;d++){var h=a.attributes[d];if(h.name&&0===h.name.indexOf("data-lwf-")){var j=h.name.slice(9),j=j.replace(/_./g,g);if("displaySetting"!==j){h=h.value;try{"{"===h.charAt(0)&&(h=JSON.parse(h))}catch(D){}c[j]=h}}}2===b.devicePixelRatio&&this.useLargeImage&&(c.imageSuffix="_@2x");c.hasOwnProperty("lwf")||(g=a.getAttribute("data-lwf"),_.isString(g)&&(c.lwf=g));c.hasOwnProperty("name")&&
(c.lwf=c.name);_.isObject(i)&&_.extend(c,i);0<this.initializeHooks.length&&_.each(this.initializeHooks,_.bind(function(b){if(_.isFunction(b)){b=b.call(this,a);for(var d in b)b.hasOwnProperty(d)&&_.extend(c[d],b[d])}},this));this.initializeHooks=[];if(!c.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");g={};g.debugInfoElementId=++x;g.setting=c;g.loader=this;g.debug=!1;g.soundMap=null;g.pageTransitionMap=null;g.buttonEventMap=null;g.fsCommandMap=null;g.handler=null;g.callback=null;g.stageEventReceiver=
null;g.lwfMap=null;g.debug=this.debug;c.privateData.hasOwnProperty("lwfLoader")||(c.privateData.lwfLoader=this);c.imageMap=this.getImageMapper_(c.imageMap);_.isEmpty(c.soundMap)||(g.soundMap=c.soundMap);delete c.soundMap;_.isObject(c.pageTransitionMap)&&(g.pageTransitionMap=c.pageTransitionMap);delete c.pageTransitionMap;g.buttonEventMap=c.buttonEventMap;delete c.buttonEventMap;_.isEmpty(c.fsCommandMap)||(g.fsCommandMap=c.fsCommandMap);delete c.fsCommandMap;_.isEmpty(c.handler)||(g.handler=c.handler);
delete c.handler;g.callback=c.callback;delete c.callback;g.lwfMap=c.lwfMap;delete c.lwfMap;g.resizeStretch=c.resizeStretch;delete c.resizeStretch;this.isLwfsEnvironment_()&&(d=c.prefix?c.prefix+c.lwf:c.lwf,c.prefix=d.slice(0,d.lastIndexOf("/")+1),delete c.imagePrefix,c.lwf=d.slice(d.lastIndexOf("/")+1));d={position:"absolute",top:0,left:0};_.extend(d,c.pos);delete c.pos;if("static"===a.style.position||""===a.style.position)a.style.position="relative";f=s(f);f.style.position=d.position;f.style.top=
d.top+"px";f.style.left=d.left+"px";f.style.zIndex=a.style.zIndex+1;a.appendChild(f);j=null;m?(j=document.createElement("div"),j.style.position="absolute",j.style.top=d.top+"px",j.style.left=d.left+"px",j.style.zIndex=f.style.zIndex+1,a.appendChild(j)):j=f;c.stage=f;g.stageEventReceiver=j;if(this.debug||g.debug)f=document.createElement("div"),f.id="lwf_info"+x,f.style.position=d.position,f.style.top=d.top+"px",f.style.left=d.left+"px",f.style.color="white",f.style.zIndex=1E4,a.appendChild(f);if(c.lwf){g.useLwfJs=
/\.lwf.js(\?.*)?$/.test(c.lwf);if(c.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");c.privateData._loaderData=g;e.loadLWF(c)}else console.error("[LWF] no LWF input")};h.prototype.requestLWF_=function(a,b,e,f,c){var g={};if(this.isLwfsEnvironment_()){var d=_.clone(window.testlwf_settings);d.prefix?g=d.prefix+b+"/_/":(g=document.location.pathname,g=g.replace(a.name,b),g=g.slice(0,g.lastIndexOf("/")+1)+"_/");d.prefix=g;delete d.imagePrefix;g=this.getLwfPath_(b);
if(!g)return console.error("[LWF] no LWF input"),c("no LWF input",null),null;d.lwf=g;p&&(d.lwf+=".js");d.parentLWF=a;d.stage=a.stage;d.worker=n;d.active=!1;e&&(d.imageMap=this.getImageMapper_(e));f&&(d.privateData=f);d.onload=function(a){var b=this.privateData.lwfLoader;return!a?(b.handleLoadError_(this),c(this.error,a)):c(null,a)}}else{d=a.privateData;if("undefined"===typeof d)return console.error("[LWF] Parent private data is not found"),c("no parents data found",null),null;var h=_.clone(d._loaderData);
if("undefined"===typeof h)return console.error("[LWF] Parent Loader data is not found"),c("no loader parameters to inherit"),null;d=_.clone(h.setting);d.fitForHeight=d.fitForWidth=!1;h.setting=d;g=null;try{g=this.getLwfMapper_(h)(b)}catch(j){this.handleException_(j,h)}if(!g)return console.error("[LWF] no LWF input"),c("no LWF input",null),null;d.lwf=g;h.useLwfJs&&(d.lwf+=".js");d.parentLWF=a;d.stage=a.stage;d.worker=n;d.active=!1;e&&(d.imageMap=this.getImageMapper_(e));f&&(f._loaderData=h,d.privateData=
f,f.prefix&&(d.prefix=f.prefix),f.imagePrefix&&(d.imagePrefix=f.imagePrefix));d.onload=function(a){var b=h.loader;return!a?(b.handleLoadError_(this,h),c(this.error,a)):c(null,a)}}return d};h.prototype.requestLWF=function(a,b,e,f,c){a=this.requestLWF_(a,b,e,f,c);_.isNull(a)||this.requests.push(a)};h.prototype.loadLWF=function(a,h,e,f,c){a=this.requestLWF_(a,h,e,f,c);_.isNull(a)||b.LWF.ResourceCache.get().loadLWF(a)};h.prototype.loadLWFs=function(a){b.LWF.ResourceCache.get().loadLWFs(this.requests,
a);this.requests=[]};b.LwfLoader=h})(window);
