window.LWFLOADER_ENABLE_DEBUG=!0;window.Utility={};window.Utility.addVirtualTouchEnd=function(a,q,g){var j=null,n=0,l=0;a.addEventListener("touchstart",function(a){a.preventDefault();a.changedTouches&&a.changedTouches[0]&&(j=a.changedTouches[0],n=j.clientX,l=j.clientY)},g);a.addEventListener("touchend",function(a){a.preventDefault();if(null!==j){if(j&&a.changedTouches&&a.changedTouches[0]){var g=n-a.changedTouches[0].clientX,i=l-a.changedTouches[0].clientY;if(400<g*g+i*i)return}j=null;q(a)}},g)};
window.Utility.getRenderer=function(){var a=navigator.userAgent;return/Android 2\.1/.test(a)||/Android 4/.test(a)&&!/Chrome/.test(a)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(a){var q=["log","warn","error"],g=a.console.log,j=a.console.warn,n=a.console.error,l={log:function(){if(window.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var i="",j=["privateData","data","url","width","height"],l=0;l<arguments.length;l++){var m="",n;for(n in arguments[l])-1!==j.indexOf(n)&&(m+=n+"="+arguments[l][n]+"\n");i+=m}arguments[0]=arguments[0].replace(/%o/,i)}return g.apply(a.console,arguments)}},warn:function(){if(window.LWFLOADER_ENABLE_DEBUG)return j.apply(a.console,
arguments)},error:function(){if(window.LWFLOADER_ENABLE_DEBUG)return n.apply(a.console,arguments)}},m,w,i;m=0;for(w=q.length;m<w;++m)i=q[m],a.console[i]=l[i]})(window);
(function(a){function q(d){d="useCanvasRenderer"===d||"useWebGLRenderer"===d?document.createElement("canvas"):document.createElement("div");d.width=d.height=0;return d}function g(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;return this}var j=navigator.userAgent,n=/iPhone/.test(j)||/iPod/.test(j)||/iPad/.test(j),l=/Android/.test(j),m=n||l,w=/Chrome/.test(j),i=null,r=!l||w,s="fitForWidth",E=/(iPhone|iPad)/.test(j)||/Android *(4|3)\..*/.test(j),I=[],
x=0;"undefined"===typeof a.performance&&(a.performance={});a.performance.now=a.performance.now||a.performance.webkitNow||a.performance.mozNow||a.performance.oNow||a.performance.msNow||Date.now;a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame;void 0===a.requestAnimationFrame&&function(){var d=1E3/60,G=a.performance.now();a.requestAnimationFrame=function(c){var h=a.performance.now()-G;return a.setTimeout(function(){G=
a.performance.now();c()},d-(h>d?h%d:h))}}();g.prototype.isLwfsEnvironment_=function(){return a.testlwf_lwf};g.prototype.addInitializeHook=function(d){_.isFunction(d)&&this.initializeHooks.push(d)};g.prototype.pause=function(){this.pausing=!0};g.prototype.resume=function(){this.pausing=!1};g.prototype.getLwfMapper_=function(d){if(null===d.lwfMap)return _.bind(this.getLwfPath_,this);var a=d.lwfMap;if(_.isObject(a))return _.isFunction(a)?a:function(c){var d=c;a.hasOwnProperty(c)&&(d=a[c]);/\.lwf$/.test(d)||
(d+=".lwf");return d};throw Error("unsupported lwfMap");};g.prototype.getLwfPath_=function(d){var a=d;0<=d.indexOf("/")&&(a=d.substring(d.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?a+".lwf":d+"/_/"+a+".lwf"};g.prototype.getImageMapper_=function(d,a){if(_.isFunction(d))return d;var c=a?"?"+a:"",h=this.isLwfsEnvironment_();return function(b){var a;a=b;a=d[a]?d[a]:null;if(null!==a)return a;if(h)return b;0===b.indexOf("lwf_")?(a=this.lwf,b="lwf/"+a.slice(0,a.lastIndexOf("/")+1)+b):0===b.indexOf("param_")?
(console.error("[LWF] error: no imageMap setting for %s, use dummy image.",b),b="lwf/dummy.png"):b=b.replace(/_/g,"/");return c?b+c:b}};g.prototype.handleException_=function(d,a){var c=a.pageTransitionMap,h=null;c.hasOwnProperty("error")?h=c.error:0<_.size(c)&&(h=_.find(c,function(){return!0}));c=a.handler;null===c||void 0===c.exception?confirm("LWF exception. \n"+d.stack+"\n reload?")&&location.reload():_.isFunction(c.exception)&&c.exception(d,h);console.error("[LWF] exception: %s",d.stack)};g.prototype.handleLoadError_=
function(d,a){var c=a.pageTransitionMap,h=null;c.hasOwnProperty("error")?0<_.size(c)&&(h=_.find(c,function(){return!0})):h=c.error;c=a.handler;null===c||void 0===c.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(c.loadError)&&c.loadError(d,h);console.error("[LWF] load error: %o",d.error);console.error("[LWF] loaded count: %d/%d",d.loadedCount,d.total)};g.prototype.onLoad=function(d){var g=this,c=g.privateData._loaderData,h=c.loader,b=c.stageEventReceiver;g.privateData=
null;if(d){I.push(d);if(_.isFunction(c.callback.onLoad))c.callback.onLoad(d);var f,e,B,p,C,k=this.stage,q=0,s=0,t=1,y=0,z=0,r=a.performance.now(),F=0,x=r,H=0;d.rootMovie.moveTo(0,0);f=function(){try{if(d){var e=a.devicePixelRatio;"useWebkitCSSRenderer"===i&&(e=1);var u=d.width,v=d.height;u>a.innerWidth&&(u=a.innerWidth);v>a.innerHeight&&(v=a.innerHeight);if(q!==u||s!==v)g.fitForWidth?(y=Math.round(u),z=Math.round(u*d.height/d.width)):(y=Math.round(v*d.width/d.height),z=Math.round(v)),b.style.width=
k.style.width=y+"px",b.style.height=k.style.height=z+"px",b.width=k.width=~~(y*e),b.height=k.height=~~(z*e),g.fitForWidth?(t=y/k.width,d.property.clear(),d.fitForWidth(k.width,k.height)):(t=z/k.height,d.property.clear(),d.fitForHeight(k.width,k.height)),q=u,s=v;var j=a.performance.now(),e=j-r;r=j;h.pausing||(d.exec(e/1E3),d.render());a.requestAnimationFrame(f);if(h.debug||c.debug)0===F%60&&(H=Math.round(6E4/(j-x)),x=j,F=0),document.getElementById("lwf_info"+c.debugInfoElementId).innerHTML=H+"fps",
F++}}catch(C){h.handleException_(C,c)}};e=function(b){try{if(E&&b.preventDefault(),d){var a,e;if(m){var f=b.touches[0];a=f.pageX;e=f.pageY}else a=b.clientX,e=b.clientY;m?(a-=k.offsetLeft,e-=k.offsetTop):(a+=document.body.scrollLeft+document.documentElement.scrollLeft-k.offsetLeft,e+=document.body.scrollTop+document.documentElement.scrollTop-k.offsetTop);a/=t;e/=t;d.inputPoint(a,e)}}catch(g){h.handleException_(g,c)}};B=function(b){try{if(E&&b.preventDefault(),d){var a,e;if(m){var f=b.touches[0];a=
f.pageX;e=f.pageY}else a=b.clientX,e=b.clientY;m?(a-=k.offsetLeft,e-=k.offsetTop):(a+=document.body.scrollLeft+document.documentElement.scrollLeft-k.offsetLeft,e+=document.body.scrollTop+document.documentElement.scrollTop-k.offsetTop);a/=t;e/=t;d.inputPoint(a,e);d.inputPress()}}catch(g){h.handleException_(g,c)}};p=function(b){try{E&&b.preventDefault(),d&&d.inputRelease()}catch(a){h.handleException_(a,c)}};C=function(b){try{d&&a.location.reload(!0)}catch(e){h.handleException_(e,c)}};a.requestAnimationFrame(f);
m?(l&&(w||/ SC-0/.test(j))&&document.body.addEventListener("touchstart",function(){}),n&&(h.debug||c.debug)&&b.addEventListener("gestureend",C,!1),b.addEventListener("touchmove",e,!1),b.addEventListener("touchstart",B,!1),b.addEventListener("touchend",p,!1)):(b.addEventListener("mousemove",e,!1),b.addEventListener("mousedown",B,!1),b.addEventListener("mouseup",p,!1));_.each(c.buttonEventMap,function(b,a){_.isFunction(b)?b={release:b}:_.each(b,function(b,d){if(!_.isFunction(b))throw Error("button event ["+
d+"@"+a+"] is not a function!");});d.setButtonEventHandler(a,b)});var A={},D=function(b,a){A.hasOwnProperty(b)||(A[b]=[]);A[b].push(a)};_.isObject(c.fsCommandMap)&&_.each(c.fsCommandMap,function(b,a){_.isFunction(b)&&D(a,b)});_.isObject(c.pageTransitionMap)&&_.each(c.pageTransitionMap,function(b,a){_.isString(b)?D(a,function(){document.location.href=b}):_.isFunction(b)&&D(a,function(){b(a)})});D=null;_.each(A,function(b,a){d.setEventHandler(a,function(a,d){for(var c=b.length,e=0;e<c;++e)b[e](a,d)})});
A=null}else h.handleLoadError_(this,c)};g.prototype.playLWF=function(d,g){var c=d.getAttribute("data-lwf-setting"),c=c?JSON.parse(c):{};s=c.resizeMode||s;var h;h=a.LWF;if(i){if(c.renderer&&i!==c.renderer)throw Error("cannot use multiple renderer! LWF has been initialized for "+i+" renderer.");}else if(i=c.renderer||a.Utility.getRenderer(),"canvas"===i?i="useCanvasRenderer":"webkitcss"===i?i="useWebkitCSSRenderer":"webgl"===i&&(i="useWebGLRenderer"),i.match(/use.+Renderer/i))h[i]();else throw Error("Renderer parameters are not properly set");
h=h.ResourceCache.get();var b=_.isObject(a.lwfDefaultParam)?_.clone(a.lwfDefaultParam):{};b.debug=b.debug?!0:!1;b.onload=this.onLoad;_.isUndefined(c.backgroundColor)?b.useBackgroundColor=!0:b.setBackgroundColor=c.backgroundColor;b.fitForHeight=!1;b.fitForWidth=!1;b[s]=!0;b.worker=r;b.imageVersion=d.getAttribute("data-lwf-image_version");l&&(/ SC-0/.test(j)&&"useWebkitCSSRenderer"===i)&&(b.quirkyClearRect=!0);l&&(b.use3D=!1);b.privateData={};b.pos=null;b.imageMap={};b.soundMap={};b.pageTransitionMap=
{};b.buttonEventMap={};b.fsCommandMap={};b.handler={};b.callback={};b.lwfMap=null;for(c=0;c<d.attributes.length;c++){var f=d.attributes[c];if(f.name&&0===f.name.indexOf("data-lwf-")){var e=f.name.slice(9),e=e.replace(/_./g,function(b){return b.charAt(1).toUpperCase()});if("setting"!==e){f=f.value;try{"{"===f.charAt(0)&&(f=JSON.parse(f))}catch(B){}b[e]=f}}}2==a.devicePixelRatio&&b.useHighResImage&&(b.imageSuffix="_@2x");b.hasOwnProperty("lwf")||(c=d.getAttribute("data-lwf"),_.isString(c)&&(b.lwf=c));
b.hasOwnProperty("name")&&(b.lwf=b.name);_.isObject(g)&&_.extend(b,g);0<this.initializeHooks.length&&_.each(this.initializeHooks,_.bind(function(a){if(_.isFunction(a)){a=a.call(this,d);for(var c in a)a.hasOwnProperty(c)&&_.extend(b[c],a[c])}},this));this.initializeHooks=[];if(!b.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");c={};c.debugInfoElementId=++x;c.setting=b;c.resizeMode=s;c.loader=this;c.debug=!1;c.soundMap=null;c.pageTransitionMap=null;c.buttonEventMap=null;c.fsCommandMap=null;
c.handler=null;c.callback=null;c.stageEventReceiver=null;c.lwfMap=null;d.getAttribute("data-debug")&&(b.privateData.debug=!0);c.debug=b.debug?!0:!1;delete b.debug;b.privateData.hasOwnProperty("lwfLoader")||(b.privateData.lwfLoader=this);b.imageMap=this.getImageMapper_(b.imageMap,b.imageVersion);_.isEmpty(b.soundMap)||(c.soundMap=b.soundMap);delete b.soundMap;_.isObject(b.pageTransitionMap)&&(c.pageTransitionMap=b.pageTransitionMap);delete b.pageTransitionMap;c.buttonEventMap=b.buttonEventMap;delete b.buttonEventMap;
_.isEmpty(b.fsCommandMap)||(c.fsCommandMap=b.fsCommandMap);delete b.fsCommandMap;_.isEmpty(b.handler)||(c.handler=b.handler);delete b.handler;c.callback=b.callback;delete b.callback;c.lwfMap=b.lwfMap;delete b.lwfMap;this.isLwfsEnvironment_()&&(e=b.prefix?b.prefix+b.lwf:b.lwf,b.prefix=e.slice(0,e.lastIndexOf("/")+1),delete b.imagePrefix,b.lwf=e.slice(e.lastIndexOf("/")+1));e={position:"absolute",top:0,left:0};_.extend(e,b.pos);delete b.pos;if("static"===d.style.position||""===d.style.position)d.style.position=
"relative";f=q(i);f.style.position=e.position;f.style.top=e.top+"px";f.style.left=e.left+"px";f.style.zIndex=d.style.zIndex+1;d.appendChild(f);var p=null;m?(p=document.createElement("div"),p.style.position=e.position,p.style.top=e.top+"px",p.style.left=e.left+"px",p.style.zIndex=f.style.zIndex+1,d.appendChild(p)):p=f;b.stage=f;c.stageEventReceiver=p;if(this.debug||c.debug)f=document.createElement("div"),f.id="lwf_info"+x,f.style.position=e.position,f.style.top=e.top+"px",f.style.left=e.left+"px",
f.style.color="white",f.style.zIndex=1E4,d.appendChild(f);if(b.lwf){c.useLwfJs=/\.lwf.js(\?.*)?$/.test(b.lwf);if(b.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");b.privateData._loaderData=c;h.loadLWF(b)}else console.error("[LWF] no LWF input")};g.prototype.requestLWF_=function(a,g,c,h,b){var f={};if(this.isLwfsEnvironment_()){var e=_.clone(window.testlwf_settings);e.prefix?f=e.prefix+g+"/_/":(f=document.location.pathname,f=f.replace(a.name,
g),f=f.slice(0,f.lastIndexOf("/")+1)+"_/");e.prefix=f;delete e.imagePrefix;f=this.getLwfPath_(g);if(!f)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;e.lwf=f;l&&(e.lwf+=".js");e.parentLWF=a;e.stage=a.stage;e.worker=r;e.active=!1;c&&(e.imageMap=this.getImageMapper_(c,e.imageVersion));h&&(e.privateData=h);e.onload=function(a){var c=this.privateData.lwfLoader;return!a?(c.handleLoadError_(this),b(this.error,a)):b(null,a)}}else{e=a.privateData;if("undefined"===typeof e)return console.error("[LWF] Parent private data is not found"),
b("no parents data found",null),null;var i=_.clone(e._loaderData);if("undefined"===typeof i)return console.error("[LWF] Parent Loader data is not found"),b("no loader parameters to inherit"),null;e=_.clone(i.setting);e.fitForHeight=e.fitForWidth=!1;i.setting=e;f=null;try{f=this.getLwfMapper_(i)(g)}catch(j){this.handleException_(j,i)}if(!f)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;e.lwf=f;i.useLwfJs&&(e.lwf+=".js");e.parentLWF=a;e.stage=a.stage;e.worker=r;e.active=!1;c&&
(e.imageMap=this.getImageMapper_(c,e.imageVersion));h&&(h._loaderData=i,e.privateData=h);e.onload=function(a){var c=i.loader;return!a?(c.handleLoadError_(this,i),b(this.error,a)):b(null,a)}}return e};g.prototype.requestLWF=function(a,g,c,h,b){a=this.requestLWF_(a,g,c,h,b);_.isNull(a)||this.requests.push(a)};g.prototype.loadLWFs=function(d){a.LWF.ResourceCache.get().loadLWFs(this.requests,d);this.requests=[]};g.prototype.loadLWF=function(d,g,c,h,b){d=this.requestLWF_(d,g,c,h,b);_.isNull(d)||a.LWF.ResourceCache.get().loadLWF(d)};
a.LwfLoader=g;g.prototype.playLWF=g.prototype.playLWF;g.prototype.loadLWF=g.prototype.loadLWF;g.prototype.addInitializeHook=g.prototype.addInitializeHook})(window);
