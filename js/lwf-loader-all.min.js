window.Utility={};window.Utility.addVirtualTouchEnd=function(a,r,h){var i=null,u=0,m=0;a.addEventListener("touchstart",function(a){a.preventDefault();a.changedTouches&&a.changedTouches[0]&&(i=a.changedTouches[0],u=i.clientX,m=i.clientY)},h);a.addEventListener("touchend",function(a){a.preventDefault();if(null!==i){if(i&&a.changedTouches&&a.changedTouches[0]){var h=u-a.changedTouches[0].clientX,p=m-a.changedTouches[0].clientY;if(400<h*h+p*p)return}i=null;r(a)}},h)};
window.Utility.getRenderer=function(){var a=navigator.userAgent;return/Android 2\.1/.test(a)||/Android 4/.test(a)&&!/Chrome/.test(a)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(a){var r=["log","warn","error"],h=a.console.log,i=a.console.warn,u=a.console.error,m={log:function(){if(a.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var i="",m=["privateData","data","url","width","height"],c=0;c<arguments.length;c++){var k="",e;for(e in arguments[c])-1!==m.indexOf(e)&&(k+=e+"="+arguments[c][e]+"\n");i+=k}arguments[0]=arguments[0].replace(/%o/,i)}return h.apply(a.console,arguments)}},warn:function(){if(a.LWFLOADER_ENABLE_DEBUG)return i.apply(a.console,
arguments)},error:function(){if(a.LWFLOADER_ENABLE_DEBUG)return u.apply(a.console,arguments)}},n,y,p;n=0;for(y=r.length;n<y;++n)p=r[n],a.console[p]=m[p]})(window);
(function(a){function r(c){c="useCanvasRenderer"===c||"useWebGLRenderer"===c?document.createElement("canvas"):document.createElement("div");c.width=c.height=0;return c}function h(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;this.backgroundColor=null;this.resizeMode="fitForWidth";this.displayDivId=this.resizeStretch=null;this.heightLimit=this.widthLimit=0;this.useLargeImage=!1;this.rootOffset={x:0,y:0};var c=null,a=0;this.getRenderer=function(){return c};
this.setRenderer=function(e){if(c)throw Error("cannot use multiple renderer! LWF has been initialized for "+c+" renderer.");"canvas"===e?e="useCanvasRenderer":"webkitcss"===e?e="useWebkitCSSRenderer":"webgl"===e&&(e="useWebGLRenderer");e&&e.match(/use.+Renderer/i)&&(c=e)};this.getCurrentFPS=function(){isNaN(a)&&console.error("[LWF] FPS is not properly defined");return a};this.setCurrentFPS=function(c){isNaN(c)&&console.error("[LWF] FPS is not properly defined");a=c};return this}var i=navigator.userAgent,
u=/iPhone/.test(i)||/iPod/.test(i)||/iPad/.test(i),m=/Android/.test(i),n=u||m,y=/Chrome/.test(i),p=!m||y,C=/(iPhone|iPad)/.test(i)||/Android *(4|3)\..*/.test(i),z=0;"undefined"===typeof a.performance&&(a.performance={});a.performance.now=a.performance.now||a.performance.webkitNow||a.performance.mozNow||a.performance.oNow||a.performance.msNow||Date.now;a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame;
void 0===a.requestAnimationFrame&&function(){var c=1E3/60,k=a.performance.now();a.requestAnimationFrame=function(e){var f=a.performance.now()-k;return a.setTimeout(function(){k=a.performance.now();e()},c-(f>c?f%c:f))}}();h.prototype.isLwfsEnvironment_=function(){return a.testlwf_settings};h.prototype.addInitializeHook=function(c){_.isFunction(c)&&this.initializeHooks.push(c)};h.prototype.pause=function(){this.pausing=!0};h.prototype.resume=function(){this.pausing=!1};h.prototype.getLwfMapper_=function(c){if(null===
c.lwfMap)return _.bind(this.getLwfPath_,this);var a=c.lwfMap;if(_.isObject(a))return _.isFunction(a)?a:function(c){var f=c;a.hasOwnProperty(c)&&(f=a[c]);/\.lwf$/.test(f)||(f+=".lwf");return f};throw Error("unsupported lwfMap");};h.prototype.getLwfPath_=function(c){var a=c;0<=c.indexOf("/")&&(a=c.substring(c.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?a+".lwf":c+"/_/"+a+".lwf"};h.prototype.getImageMapper_=function(c){return _.isFunction(c)?c:function(a){return c[a]?c[a]:a}};h.prototype.setDisplaySetting=
function(c){c.renderer&&this.setRenderer(c.renderer);this.resizeMode=c.resizeMode||this.resizeMode;this.resizeStretch=c.resizeStretch||this.resizeStretch;this.displayDivId=c.displayDivId||this.displayDivId;this.widthLimit=c.widthLimit||this.widthLimit;this.heightLimit=c.heightLimit||this.heightLimit;this.useLargeImage=c.useLargeImage||this.useLargeImage};h.prototype.handleException_=function(c,a){var e=a.pageTransitionMap,f=null;e.hasOwnProperty("error")?f=e.error:0<_.size(e)&&(f=_.find(e,function(){return!0}));
e=a.handler;null===e||void 0===e.exception?confirm("LWF exception. \n"+c.stack+"\n reload?")&&location.reload():_.isFunction(e.exception)&&e.exception(c,f);console.error("[LWF] exception: %s",c.stack)};h.prototype.handleLoadError_=function(c,a){var e=a.pageTransitionMap,f=null;e.hasOwnProperty("error")?0<_.size(e)&&(f=_.find(e,function(){return!0})):f=e.error;e=a.handler;null===e||void 0===e.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(e.loadError)&&e.loadError(c,
f);console.error("[LWF] load error: %o",c.error);console.error("[LWF] loaded count: %d/%d",c.loadedCount,c.total)};h.prototype.onLoad=function(c){var k=this,e=k.privateData._loaderData,f=e.loader,b=e.stageEventReceiver;k.privateData=null;if(c){if(_.isFunction(e.callback.onLoad))e.callback.onLoad(c);var g,d,h,j,D,l=this.stage,p=0,r=0,v=1,w=0,x=0,E=a.performance.now(),F=0,z=E,G=0;c.rootMovie.moveTo(f.rootOffset.x,f.rootOffset.y);g=function(){try{if(c){var d=a.devicePixelRatio;"useWebkitCSSRenderer"===
f.getRenderer()&&(d=1);var s=c.width,t=c.height,h=a.innerWidth,i=a.innerHeight;m&&(a.innerWidth>a.screen.width&&(h=a.screen.width),a.innerHeight>a.screen.height&&(i=a.screen.height));if(s>h||e.resizeStretch)s=h;if(t>i||e.resizeStretch)t=i;if(p!==s||r!==t)if(k.fitForWidth?(k.widthLimit&&(s=s>k.widthLimit?k.widthLimit:s),w=Math.round(s),x=Math.round(s*c.height/c.width)):(k.heightLimit&&(t=t>k.heightLimit?k.heightLimit:t),w=Math.round(t*c.width/c.height),x=Math.round(t)),b.style.width=l.style.width=
w+"px",b.style.height=l.style.height=x+"px",b.width=l.width=Math.floor(w*d),b.height=l.height=Math.floor(x*d),k.fitForWidth?(v=w/l.width,c.property.clear(),c.fitForWidth(l.width,l.height)):(v=x/l.height,c.property.clear(),c.fitForHeight(l.width,l.height)),p=s,r=t,f.displayDivId){var q=document.getElementById(f.displayDivId);q.style.width=w+"px";q.style.height=x+"px"}var j=a.performance.now(),d=j-E;E=j;f.pausing||(c.exec(d/1E3),c.render());a.requestAnimationFrame(g);0===F%60&&(G=Math.round(6E4/(j-
z)),z=j,F=0);if(f.debug||e.debug)document.getElementById("lwf_info"+e.debugInfoElementId).innerHTML=G+"fps";F++;f.setCurrentFPS(G)}}catch(n){f.handleException_(n,e)}};d=function(a){try{if(C&&a.preventDefault(),c){var b,d,g=l.getBoundingClientRect();if(n){var h=a.touches[0];b=h.pageX;d=h.pageY}else b=a.clientX,d=a.clientY;n?(b-=l.offsetLeft,d-=l.offsetTop,b=b-g.left-window.scrollX,d=d-g.top-window.scrollY):(b-=g.left,d-=g.top);b/=v;d/=v;c.inputPoint(b,d)}}catch(k){f.handleException_(k,e)}};h=function(b){try{if(C&&
b.preventDefault(),c){var a,d,g=l.getBoundingClientRect();if(n){var h=b.touches[0];a=h.pageX;d=h.pageY}else a=b.clientX,d=b.clientY;n?(a-=l.offsetLeft,d-=l.offsetTop,a=a-g.left-window.scrollX,d=d-g.top-window.scrollY):(a-=g.left,d-=g.top);a/=v;d/=v;c.inputPoint(a,d);c.inputPress()}}catch(k){f.handleException_(k,e)}};j=function(a){try{C&&a.preventDefault(),c&&c.inputRelease()}catch(b){f.handleException_(b,e)}};D=function(b){try{c&&a.location.reload(!0)}catch(d){f.handleException_(d,e)}};a.requestAnimationFrame(g);
n?(m&&(y||/ SC-0/.test(i))&&document.body.addEventListener("touchstart",function(){}),u&&(f.debug||e.debug)&&b.addEventListener("gestureend",D,!1),b.addEventListener("touchmove",d,!1),b.addEventListener("touchstart",h,!1),b.addEventListener("touchend",j,!1)):(b.addEventListener("mousemove",d,!1),b.addEventListener("mousedown",h,!1),b.addEventListener("mouseup",j,!1));_.each(e.buttonEventMap,function(a,b){_.isFunction(a)?a={release:a}:_.each(a,function(a,c){if(!_.isFunction(a))throw Error("button event ["+
c+"@"+b+"] is not a function!");});c.setButtonEventHandler(b,a)});var A={},B=function(a,b){A.hasOwnProperty(a)||(A[a]=[]);A[a].push(b)};_.isObject(e.fsCommandMap)&&_.each(e.fsCommandMap,function(a,b){_.isFunction(a)&&B(b,a)});_.isObject(e.pageTransitionMap)&&_.each(e.pageTransitionMap,function(a,b){_.isString(a)?B(b,function(){document.location.href=a}):_.isFunction(a)&&B(b,function(){a(b)})});B=null;_.each(A,function(a,b){c.setEventHandler(b,function(b,c){for(var d=a.length,e=0;e<d;++e)a[e](b,c)})});
A=null}else f.handleLoadError_(this,e)};h.prototype.playLWF=function(c,h){var e=c.getAttribute("data-lwf-display_setting");e&&(e=JSON.parse(e),this.setDisplaySetting(e));e=a.LWF;this.getRenderer()||this.setRenderer(a.Utility.getRenderer());var f=this.getRenderer();if(f)e[f]();else throw Error("Renderer parameters are not properly set");e=e.ResourceCache.get();this.debug&&(a.LWFLOADER_ENABLE_DEBUG=!0);var b=_.isObject(a.lwfDefaultParam)?_.clone(a.lwfDefaultParam):{};b.onload=this.onLoad;this.backgroundColor?
b.setBackgroundColor=this.backgroundColor:b.useBackgroundColor=!0;b.fitForHeight=!1;b.fitForWidth=!1;"fitForWidth"===this.resizeMode?b.fitForWidth=!0:"fitForHeight"===this.resizeMode&&(b.fitForHeight=!0);b.resizeStretch=this.resizeStretch;b.widthLimit=this.widthLimit;b.heightLimit=this.heightLimit;b.worker=p;m&&(/ SC-0/.test(i)&&"useWebkitCSSRenderer"===f)&&(b.quirkyClearRect=!0);m&&(b.use3D=!1);b.privateData={};b.pos=null;b.imageMap={};b.soundMap={};b.pageTransitionMap={};b.buttonEventMap={};b.fsCommandMap=
{};b.handler={};b.callback={};b.lwfMap=null;for(var g=function(a){return a.charAt(1).toUpperCase()},d=0;d<c.attributes.length;d++){var q=c.attributes[d];if(q.name&&0===q.name.indexOf("data-lwf-")){var j=q.name.slice(9),j=j.replace(/_./g,g);if("displaySetting"!==j){q=q.value;try{"{"===q.charAt(0)&&(q=JSON.parse(q))}catch(D){}b[j]=q}}}2===a.devicePixelRatio&&this.useLargeImage&&(b.imageSuffix="_@2x");b.hasOwnProperty("lwf")||(g=c.getAttribute("data-lwf"),_.isString(g)&&(b.lwf=g));b.hasOwnProperty("name")&&
(b.lwf=b.name);_.isObject(h)&&_.extend(b,h);0<this.initializeHooks.length&&_.each(this.initializeHooks,_.bind(function(a){if(_.isFunction(a)){a=a.call(this,c);for(var d in a)a.hasOwnProperty(d)&&_.extend(b[d],a[d])}},this));this.initializeHooks=[];if(!b.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");g={};g.debugInfoElementId=++z;g.setting=b;g.loader=this;g.debug=!1;g.soundMap=null;g.pageTransitionMap=null;g.buttonEventMap=null;g.fsCommandMap=null;g.handler=null;g.callback=null;g.stageEventReceiver=
null;g.lwfMap=null;g.debug=this.debug;b.privateData.hasOwnProperty("lwfLoader")||(b.privateData.lwfLoader=this);b.imageMap=this.getImageMapper_(b.imageMap);_.isEmpty(b.soundMap)||(g.soundMap=b.soundMap);delete b.soundMap;_.isObject(b.pageTransitionMap)&&(g.pageTransitionMap=b.pageTransitionMap);delete b.pageTransitionMap;g.buttonEventMap=b.buttonEventMap;delete b.buttonEventMap;_.isEmpty(b.fsCommandMap)||(g.fsCommandMap=b.fsCommandMap);delete b.fsCommandMap;_.isEmpty(b.handler)||(g.handler=b.handler);
delete b.handler;g.callback=b.callback;delete b.callback;g.lwfMap=b.lwfMap;delete b.lwfMap;g.resizeStretch=b.resizeStretch;delete b.resizeStretch;this.isLwfsEnvironment_()&&(d=b.prefix?b.prefix+b.lwf:b.lwf,b.prefix=d.slice(0,d.lastIndexOf("/")+1),delete b.imagePrefix,b.lwf=d.slice(d.lastIndexOf("/")+1));d={position:"absolute",top:0,left:0};_.extend(d,b.pos);delete b.pos;if("static"===c.style.position||""===c.style.position)c.style.position="relative";f=r(f);f.style.position=d.position;f.style.top=
d.top+"px";f.style.left=d.left+"px";f.style.zIndex=c.style.zIndex+1;c.appendChild(f);j=null;n?(j=document.createElement("div"),j.style.position="absolute",j.style.top=d.top+"px",j.style.left=d.left+"px",j.style.zIndex=f.style.zIndex+1,c.appendChild(j)):j=f;b.stage=f;g.stageEventReceiver=j;if(this.debug||g.debug)f=document.createElement("div"),f.id="lwf_info"+z,f.style.position=d.position,f.style.top=d.top+"px",f.style.left=d.left+"px",f.style.color="white",f.style.zIndex=1E4,c.appendChild(f);if(b.lwf){g.useLwfJs=
/\.lwf.js(\?.*)?$/.test(b.lwf);if(b.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");b.privateData._loaderData=g;e.loadLWF(b)}else console.error("[LWF] no LWF input")};h.prototype.requestLWF=function(a,h,e,f,b){var g={};if(this.isLwfsEnvironment_()){var d=_.clone(window.testlwf_settings);d.prefix?g=d.prefix+h+"/_/":(g=document.location.pathname,g=g.replace(a.name,h),g=g.slice(0,g.lastIndexOf("/")+1)+"_/");d.prefix=g;delete d.imagePrefix;g=this.getLwfPath_(h);
if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;d.lwf=g;m&&(d.lwf+=".js");d.parentLWF=a;d.stage=a.stage;d.worker=p;d.active=!1;e&&(d.imageMap=this.getImageMapper_(e));f&&(d.privateData=f);d.onload=function(a){var c=this.privateData.lwfLoader;return!a?(c.handleLoadError_(this),b(this.error,a)):b(null,a)}}else{d=a.privateData;if("undefined"===typeof d)return console.error("[LWF] Parent private data is not found"),b("no parents data found",null),null;var i=_.clone(d._loaderData);
if("undefined"===typeof i)return console.error("[LWF] Parent Loader data is not found"),b("no loader parameters to inherit"),null;d=_.clone(i.setting);d.fitForHeight=d.fitForWidth=!1;i.setting=d;g=null;try{g=this.getLwfMapper_(i)(h)}catch(j){this.handleException_(j,i)}if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;d.lwf=g;i.useLwfJs&&(d.lwf+=".js");d.parentLWF=a;d.stage=a.stage;d.worker=p;d.active=!1;e&&(d.imageMap=this.getImageMapper_(e));f&&(f._loaderData=i,d.privateData=
f,f.prefix&&(d.prefix=f.prefix),f.imagePrefix&&(d.imagePrefix=f.imagePrefix));d.onload=function(a){var c=i.loader;return!a?(c.handleLoadError_(this,i),b(this.error,a)):b(null,a)}}return d};h.prototype.loadLWFs=function(c){a.LWF.ResourceCache.get().loadLWFs(this.requests,c);this.requests=[]};h.prototype.loadLWF=function(c,h,e,f,b){c=this.requestLWF(c,h,e,f,b);_.isNull(c)||a.LWF.ResourceCache.get().loadLWF(c)};a.LwfLoader=h})(window);
