window.Utility={};window.Utility.addVirtualTouchEnd=function(a,p,f){var j=null,u=0,l=0;a.addEventListener("touchstart",function(a){a.preventDefault();a.changedTouches&&a.changedTouches[0]&&(j=a.changedTouches[0],u=j.clientX,l=j.clientY)},f);a.addEventListener("touchend",function(a){a.preventDefault();if(null!==j){if(j&&a.changedTouches&&a.changedTouches[0]){var f=u-a.changedTouches[0].clientX,i=l-a.changedTouches[0].clientY;if(400<f*f+i*i)return}j=null;p(a)}},f)};
window.Utility.getRenderer=function(){var a=navigator.userAgent;return/Android 2\.1/.test(a)||/Android 4/.test(a)&&!/Chrome/.test(a)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(a){var p=["log","warn","error"],f=a.console.log,j=a.console.warn,u=a.console.error,l={log:function(){if(a.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var i="",j=["privateData","data","url","width","height"],l=0;l<arguments.length;l++){var k="",t;for(t in arguments[l])-1!==j.indexOf(t)&&(k+=t+"="+arguments[l][t]+"\n");i+=k}arguments[0]=arguments[0].replace(/%o/,i)}return f.apply(a.console,arguments)}},warn:function(){if(a.LWFLOADER_ENABLE_DEBUG)return j.apply(a.console,
arguments)},error:function(){if(a.LWFLOADER_ENABLE_DEBUG)return u.apply(a.console,arguments)}},k,C,i;k=0;for(C=p.length;k<C;++k)i=p[k],a.console[i]=l[i]})(window);
(function(a){function p(d){d="useCanvasRenderer"===d||"useWebGLRenderer"===d?document.createElement("canvas"):document.createElement("div");d.width=d.height=0;return d}function f(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;this.currentFPS=0;return this}var j=navigator.userAgent,u=/iPhone/.test(j)||/iPod/.test(j)||/iPad/.test(j),l=/Android/.test(j),k=u||l,C=/Chrome/.test(j),i=null,x=!l||C,v="fitForWidth",w=!1,F=null,t=/(iPhone|iPad)/.test(j)||/Android *(4|3)\..*/.test(j),
J=[],D=0;"undefined"===typeof a.performance&&(a.performance={});a.performance.now=a.performance.now||a.performance.webkitNow||a.performance.mozNow||a.performance.oNow||a.performance.msNow||Date.now;a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame;void 0===a.requestAnimationFrame&&function(){var d=1E3/60,I=a.performance.now();a.requestAnimationFrame=function(c){var h=a.performance.now()-I;
return a.setTimeout(function(){I=a.performance.now();c()},d-(h>d?h%d:h))}}();f.prototype.isLwfsEnvironment_=function(){return a.testlwf_lwf};f.prototype.getCurrentFPS=function(){isNaN(this.currentFPS)&&console.error("[LWF] FPS is not properly defined");return this.currentFPS};f.prototype.addInitializeHook=function(d){_.isFunction(d)&&this.initializeHooks.push(d)};f.prototype.pause=function(){this.pausing=!0};f.prototype.resume=function(){this.pausing=!1};f.prototype.getLwfMapper_=function(d){if(null===
d.lwfMap)return _.bind(this.getLwfPath_,this);var a=d.lwfMap;if(_.isObject(a))return _.isFunction(a)?a:function(c){var d=c;a.hasOwnProperty(c)&&(d=a[c]);/\.lwf$/.test(d)||(d+=".lwf");return d};throw Error("unsupported lwfMap");};f.prototype.getLwfPath_=function(d){var a=d;0<=d.indexOf("/")&&(a=d.substring(d.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?a+".lwf":d+"/_/"+a+".lwf"};f.prototype.getImageMapper_=function(d){return _.isFunction(d)?d:function(a){return d[a]?d[a]:a}};f.prototype.handleException_=
function(d,a){var c=a.pageTransitionMap,h=null;c.hasOwnProperty("error")?h=c.error:0<_.size(c)&&(h=_.find(c,function(){return!0}));c=a.handler;null===c||void 0===c.exception?confirm("LWF exception. \n"+d.stack+"\n reload?")&&location.reload():_.isFunction(c.exception)&&c.exception(d,h);console.error("[LWF] exception: %s",d.stack)};f.prototype.handleLoadError_=function(d,a){var c=a.pageTransitionMap,h=null;c.hasOwnProperty("error")?0<_.size(c)&&(h=_.find(c,function(){return!0})):h=c.error;c=a.handler;
null===c||void 0===c.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(c.loadError)&&c.loadError(d,h);console.error("[LWF] load error: %o",d.error);console.error("[LWF] loaded count: %d/%d",d.loadedCount,d.total)};f.prototype.onLoad=function(d){var f=this,c=f.privateData._loaderData,h=c.loader,b=c.stageEventReceiver;f.privateData=null;if(d){J.push(d);if(_.isFunction(c.callback.onLoad))c.callback.onLoad(d);var g,e,q,n,y,m=this.stage,p=0,x=0,z=1,A=0,B=0,v=a.performance.now(),
w=0,D=v,H=0;d.rootMovie.moveTo(0,0);g=function(){try{if(d){var e=a.devicePixelRatio;"useWebkitCSSRenderer"===i&&(e=1);var r=d.width,s=d.height,j=a.innerWidth,y=a.innerHeight;l&&(a.innerWidth>a.screen.width&&(j=a.screen.width),a.innerHeight>a.screen.height&&(y=a.screen.height));if(r>j||c.resizeStretch)r=j;if(s>y||c.resizeStretch)s=y;if(p!==r||x!==s)if(f.fitForWidth?(f.widthLimit&&(r=r>f.widthLimit?f.widthLimit:r),A=Math.round(r),B=Math.round(r*d.height/d.width)):(f.heightLimit&&(s=s>f.heightLimit?
f.heightLimit:s),A=Math.round(s*d.width/d.height),B=Math.round(s)),b.style.width=m.style.width=A+"px",b.style.height=m.style.height=B+"px",b.width=m.width=~~(A*e),b.height=m.height=~~(B*e),f.fitForWidth?(z=A/m.width,d.property.clear(),d.fitForWidth(m.width,m.height)):(z=B/m.height,d.property.clear(),d.fitForHeight(m.width,m.height)),p=r,x=s,F){var k=document.getElementById(F);k.style.width=A+"px";k.style.height=B+"px"}var q=a.performance.now(),e=q-v;v=q;h.pausing||(d.exec(e/1E3),d.render());a.requestAnimationFrame(g);
0===w%60&&(H=Math.round(6E4/(q-D)),D=q,w=0);if(h.debug||c.debug)document.getElementById("lwf_info"+c.debugInfoElementId).innerHTML=H+"fps";w++;h.currentFPS=H}}catch(n){h.handleException_(n,c)}};e=function(b){try{if(t&&b.preventDefault(),d){var a,e,g=m.getBoundingClientRect();if(k){var f=b.touches[0];a=f.pageX;e=f.pageY}else a=b.clientX,e=b.clientY;k?(a-=m.offsetLeft,e-=m.offsetTop,a=a-g.left-window.scrollX,e=e-g.top-window.scrollY):(a+=document.body.scrollLeft+document.documentElement.scrollLeft,
e+=document.body.scrollTop+document.documentElement.scrollTop);a/=z;e/=z;d.inputPoint(a,e)}}catch(i){h.handleException_(i,c)}};q=function(a){try{if(t&&a.preventDefault(),d){var b,e,g=m.getBoundingClientRect();if(k){var f=a.touches[0];b=f.pageX;e=f.pageY}else b=a.clientX,e=a.clientY;k?(b-=m.offsetLeft,e-=m.offsetTop,b=b-g.left-window.scrollX,e=e-g.top-window.scrollY):(b+=document.body.scrollLeft+document.documentElement.scrollLeft,e+=document.body.scrollTop+document.documentElement.scrollTop);b/=z;
e/=z;d.inputPoint(b,e);d.inputPress()}}catch(i){h.handleException_(i,c)}};n=function(b){try{t&&b.preventDefault(),d&&d.inputRelease()}catch(a){h.handleException_(a,c)}};y=function(b){try{d&&a.location.reload(!0)}catch(e){h.handleException_(e,c)}};a.requestAnimationFrame(g);k?(l&&(C||/ SC-0/.test(j))&&document.body.addEventListener("touchstart",function(){}),u&&(h.debug||c.debug)&&b.addEventListener("gestureend",y,!1),b.addEventListener("touchmove",e,!1),b.addEventListener("touchstart",q,!1),b.addEventListener("touchend",
n,!1)):(b.addEventListener("mousemove",e,!1),b.addEventListener("mousedown",q,!1),b.addEventListener("mouseup",n,!1));_.each(c.buttonEventMap,function(b,a){_.isFunction(b)?b={release:b}:_.each(b,function(b,d){if(!_.isFunction(b))throw Error("button event ["+d+"@"+a+"] is not a function!");});d.setButtonEventHandler(a,b)});var E={},G=function(b,a){E.hasOwnProperty(b)||(E[b]=[]);E[b].push(a)};_.isObject(c.fsCommandMap)&&_.each(c.fsCommandMap,function(b,a){_.isFunction(b)&&G(a,b)});_.isObject(c.pageTransitionMap)&&
_.each(c.pageTransitionMap,function(b,a){_.isString(b)?G(a,function(){document.location.href=b}):_.isFunction(b)&&G(a,function(){b(a)})});G=null;_.each(E,function(b,a){d.setEventHandler(a,function(a,d){for(var c=b.length,e=0;e<c;++e)b[e](a,d)})});E=null}else h.handleLoadError_(this,c)};f.prototype.playLWF=function(d,f){var c=d.getAttribute("data-lwf-display_setting"),c=c?JSON.parse(c):{};v=c.resizeMode||v;w=c.resizeStretch||w;F=c.displayDivId||F;var h;h=a.LWF;if(i){if(c.renderer&&i!==c.renderer)throw Error("cannot use multiple renderer! LWF has been initialized for "+
i+" renderer.");}else if(i=c.renderer||a.Utility.getRenderer(),"canvas"===i?i="useCanvasRenderer":"webkitcss"===i?i="useWebkitCSSRenderer":"webgl"===i&&(i="useWebGLRenderer"),i.match(/use.+Renderer/i))h[i]();else throw Error("Renderer parameters are not properly set");h=h.ResourceCache.get();var b=_.isObject(a.lwfDefaultParam)?_.clone(a.lwfDefaultParam):{};b.onload=this.onLoad;_.isUndefined(c.backgroundColor)?b.useBackgroundColor=!0:b.setBackgroundColor=c.backgroundColor;b.fitForHeight=!1;b.fitForWidth=
!1;b[v]=!0;b.resizeStretch=w;b.widthLimit=c.widthLimit;b.heightLimit=c.heightLimit;b.worker=x;l&&(/ SC-0/.test(j)&&"useWebkitCSSRenderer"===i)&&(b.quirkyClearRect=!0);l&&(b.use3D=!1);b.privateData={};b.pos=null;b.imageMap={};b.soundMap={};b.pageTransitionMap={};b.buttonEventMap={};b.fsCommandMap={};b.handler={};b.callback={};b.lwfMap=null;for(c=0;c<d.attributes.length;c++){var g=d.attributes[c];if(g.name&&0===g.name.indexOf("data-lwf-")){var e=g.name.slice(9),e=e.replace(/_./g,function(b){return b.charAt(1).toUpperCase()});
if("displaySetting"!==e){g=g.value;try{"{"===g.charAt(0)&&(g=JSON.parse(g))}catch(q){}b[e]=g}}}2==a.devicePixelRatio&&b.useHighResImage&&(b.imageSuffix="_@2x");b.hasOwnProperty("lwf")||(c=d.getAttribute("data-lwf"),_.isString(c)&&(b.lwf=c));b.hasOwnProperty("name")&&(b.lwf=b.name);_.isObject(f)&&_.extend(b,f);0<this.initializeHooks.length&&_.each(this.initializeHooks,_.bind(function(a){if(_.isFunction(a)){a=a.call(this,d);for(var c in a)a.hasOwnProperty(c)&&_.extend(b[c],a[c])}},this));this.initializeHooks=
[];if(!b.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");c={};c.debugInfoElementId=++D;c.setting=b;c.loader=this;c.debug=!1;c.soundMap=null;c.pageTransitionMap=null;c.buttonEventMap=null;c.fsCommandMap=null;c.handler=null;c.callback=null;c.stageEventReceiver=null;c.lwfMap=null;c.debug=this.debug;b.privateData.hasOwnProperty("lwfLoader")||(b.privateData.lwfLoader=this);b.imageMap=this.getImageMapper_(b.imageMap);_.isEmpty(b.soundMap)||(c.soundMap=b.soundMap);delete b.soundMap;_.isObject(b.pageTransitionMap)&&
(c.pageTransitionMap=b.pageTransitionMap);delete b.pageTransitionMap;c.buttonEventMap=b.buttonEventMap;delete b.buttonEventMap;_.isEmpty(b.fsCommandMap)||(c.fsCommandMap=b.fsCommandMap);delete b.fsCommandMap;_.isEmpty(b.handler)||(c.handler=b.handler);delete b.handler;c.callback=b.callback;delete b.callback;c.lwfMap=b.lwfMap;delete b.lwfMap;c.resizeStretch=b.resizeStretch;delete b.resizeStretch;this.isLwfsEnvironment_()&&(e=b.prefix?b.prefix+b.lwf:b.lwf,b.prefix=e.slice(0,e.lastIndexOf("/")+1),delete b.imagePrefix,
b.lwf=e.slice(e.lastIndexOf("/")+1));e={position:"absolute",top:0,left:0};_.extend(e,b.pos);delete b.pos;if("static"===d.style.position||""===d.style.position)d.style.position="relative";g=p(i);g.style.position=e.position;g.style.top=e.top+"px";g.style.left=e.left+"px";g.style.zIndex=d.style.zIndex+1;d.appendChild(g);var n=null;k?(n=document.createElement("div"),n.style.position="absolute",n.style.top=e.top+"px",n.style.left=e.left+"px",n.style.zIndex=g.style.zIndex+1,d.appendChild(n)):n=g;b.stage=
g;c.stageEventReceiver=n;if(this.debug||c.debug)g=document.createElement("div"),g.id="lwf_info"+D,g.style.position=e.position,g.style.top=e.top+"px",g.style.left=e.left+"px",g.style.color="white",g.style.zIndex=1E4,d.appendChild(g);if(b.lwf){c.useLwfJs=/\.lwf.js(\?.*)?$/.test(b.lwf);if(b.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");b.privateData._loaderData=c;h.loadLWF(b)}else console.error("[LWF] no LWF input")};f.prototype.requestLWF_=function(a,
f,c,h,b){var g={};if(this.isLwfsEnvironment_()){var e=_.clone(window.testlwf_settings);e.prefix?g=e.prefix+f+"/_/":(g=document.location.pathname,g=g.replace(a.name,f),g=g.slice(0,g.lastIndexOf("/")+1)+"_/");e.prefix=g;delete e.imagePrefix;g=this.getLwfPath_(f);if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;e.lwf=g;l&&(e.lwf+=".js");e.parentLWF=a;e.stage=a.stage;e.worker=x;e.active=!1;c&&(e.imageMap=this.getImageMapper_(c));h&&(e.privateData=h);e.onload=function(a){var c=
this.privateData.lwfLoader;return!a?(c.handleLoadError_(this),b(this.error,a)):b(null,a)}}else{e=a.privateData;if("undefined"===typeof e)return console.error("[LWF] Parent private data is not found"),b("no parents data found",null),null;var i=_.clone(e._loaderData);if("undefined"===typeof i)return console.error("[LWF] Parent Loader data is not found"),b("no loader parameters to inherit"),null;e=_.clone(i.setting);e.fitForHeight=e.fitForWidth=!1;i.setting=e;g=null;try{g=this.getLwfMapper_(i)(f)}catch(j){this.handleException_(j,
i)}if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;e.lwf=g;i.useLwfJs&&(e.lwf+=".js");e.parentLWF=a;e.stage=a.stage;e.worker=x;e.active=!1;c&&(e.imageMap=this.getImageMapper_(c));h&&(h._loaderData=i,e.privateData=h,h.prefix&&(e.prefix=h.prefix),h.imagePrefix&&(e.imagePrefix=h.imagePrefix));e.onload=function(a){var c=i.loader;return!a?(c.handleLoadError_(this,i),b(this.error,a)):b(null,a)}}return e};f.prototype.requestLWF=function(a,f,c,h,b){a=this.requestLWF_(a,f,c,h,
b);_.isNull(a)||this.requests.push(a)};f.prototype.loadLWFs=function(d){a.LWF.ResourceCache.get().loadLWFs(this.requests,d);this.requests=[]};f.prototype.loadLWF=function(d,f,c,h,b){d=this.requestLWF_(d,f,c,h,b);_.isNull(d)||a.LWF.ResourceCache.get().loadLWF(d)};a.LwfLoader=f;f.prototype.playLWF=f.prototype.playLWF;f.prototype.loadLWF=f.prototype.loadLWF;f.prototype.addInitializeHook=f.prototype.addInitializeHook})(window);
