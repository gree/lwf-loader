window.Utility={};window.Utility.addVirtualTouchEnd=function(a,q,h){var j=null,t=0,m=0;a.addEventListener("touchstart",function(a){a.preventDefault();a.changedTouches&&a.changedTouches[0]&&(j=a.changedTouches[0],t=j.clientX,m=j.clientY)},h);a.addEventListener("touchend",function(a){a.preventDefault();if(null!==j){if(j&&a.changedTouches&&a.changedTouches[0]){var h=t-a.changedTouches[0].clientX,p=m-a.changedTouches[0].clientY;if(400<h*h+p*p)return}j=null;q(a)}},h)};
window.Utility.getRenderer=function(){var a=navigator.userAgent;return/Android 2\.1/.test(a)||/Android 4/.test(a)&&!/Chrome/.test(a)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(a){var q=["log","warn","error"],h=a.console.log,j=a.console.warn,t=a.console.error,m={log:function(){if(a.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var j="",m=["privateData","data","url","width","height"],c=0;c<arguments.length;c++){var k="",e;for(e in arguments[c])-1!==m.indexOf(e)&&(k+=e+"="+arguments[c][e]+"\n");j+=k}arguments[0]=arguments[0].replace(/%o/,j)}return h.apply(a.console,arguments)}},warn:function(){if(a.LWFLOADER_ENABLE_DEBUG)return j.apply(a.console,
arguments)},error:function(){if(a.LWFLOADER_ENABLE_DEBUG)return t.apply(a.console,arguments)}},n,y,p;n=0;for(y=q.length;n<y;++n)p=q[n],a.console[p]=m[p]})(window);
(function(a){function q(c){c="useCanvasRenderer"===c||"useWebGLRenderer"===c?document.createElement("canvas"):document.createElement("div");c.width=c.height=0;return c}function h(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;this.backgroundColor=null;this.resizeMode="fitForWidth";this.displayDivId=this.resizeStretch=null;this.heightLimit=this.widthLimit=0;this.rootOffset={x:0,y:0};var c=null,a=0;this.getRenderer=function(){return c};this.setRenderer=
function(e){if(c)throw Error("cannot use multiple renderer! LWF has been initialized for "+c+" renderer.");"canvas"===e?e="useCanvasRenderer":"webkitcss"===e?e="useWebkitCSSRenderer":"webgl"===e&&(e="useWebGLRenderer");e&&e.match(/use.+Renderer/i)&&(c=e)};this.getCurrentFPS=function(){isNaN(a)&&console.error("[LWF] FPS is not properly defined");return a};this.setCurrentFPS=function(c){isNaN(c)&&console.error("[LWF] FPS is not properly defined");a=c};return this}var j=navigator.userAgent,t=/iPhone/.test(j)||
/iPod/.test(j)||/iPad/.test(j),m=/Android/.test(j),n=t||m,y=/Chrome/.test(j),p=!m||y,C=/(iPhone|iPad)/.test(j)||/Android *(4|3)\..*/.test(j),z=0;"undefined"===typeof a.performance&&(a.performance={});a.performance.now=a.performance.now||a.performance.webkitNow||a.performance.mozNow||a.performance.oNow||a.performance.msNow||Date.now;a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame;void 0===
a.requestAnimationFrame&&function(){var c=1E3/60,k=a.performance.now();a.requestAnimationFrame=function(e){var f=a.performance.now()-k;return a.setTimeout(function(){k=a.performance.now();e()},c-(f>c?f%c:f))}}();h.prototype.isLwfsEnvironment_=function(){return a.testlwf_lwf};h.prototype.addInitializeHook=function(c){_.isFunction(c)&&this.initializeHooks.push(c)};h.prototype.pause=function(){this.pausing=!0};h.prototype.resume=function(){this.pausing=!1};h.prototype.getLwfMapper_=function(c){if(null===
c.lwfMap)return _.bind(this.getLwfPath_,this);var a=c.lwfMap;if(_.isObject(a))return _.isFunction(a)?a:function(c){var f=c;a.hasOwnProperty(c)&&(f=a[c]);/\.lwf$/.test(f)||(f+=".lwf");return f};throw Error("unsupported lwfMap");};h.prototype.getLwfPath_=function(c){var a=c;0<=c.indexOf("/")&&(a=c.substring(c.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?a+".lwf":c+"/_/"+a+".lwf"};h.prototype.getImageMapper_=function(c){return _.isFunction(c)?c:function(a){return c[a]?c[a]:a}};h.prototype.setDisplaySetting=
function(c){c.renderer&&this.setRenderer(c.renderer);this.resizeMode=c.resizeMode||this.resizeMode;this.resizeStretch=c.resizeStretch||this.resizeStretch;this.displayDivId=c.displayDivId||this.displayDivId;this.widthLimit=c.widthLimit||this.widthLimit;this.heightLimit=c.heightLimit||this.heightLimit};h.prototype.handleException_=function(c,a){var e=a.pageTransitionMap,f=null;e.hasOwnProperty("error")?f=e.error:0<_.size(e)&&(f=_.find(e,function(){return!0}));e=a.handler;null===e||void 0===e.exception?
confirm("LWF exception. \n"+c.stack+"\n reload?")&&location.reload():_.isFunction(e.exception)&&e.exception(c,f);console.error("[LWF] exception: %s",c.stack)};h.prototype.handleLoadError_=function(c,a){var e=a.pageTransitionMap,f=null;e.hasOwnProperty("error")?0<_.size(e)&&(f=_.find(e,function(){return!0})):f=e.error;e=a.handler;null===e||void 0===e.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(e.loadError)&&e.loadError(c,f);console.error("[LWF] load error: %o",c.error);
console.error("[LWF] loaded count: %d/%d",c.loadedCount,c.total)};h.prototype.onLoad=function(c){var k=this,e=k.privateData._loaderData,f=e.loader,b=e.stageEventReceiver;k.privateData=null;if(c){if(_.isFunction(e.callback.onLoad))e.callback.onLoad(c);var g,d,i,h,u,l=this.stage,p=0,q=0,v=1,w=0,x=0,D=a.performance.now(),E=0,z=D,F=0;c.rootMovie.moveTo(f.rootOffset.x,f.rootOffset.y);g=function(){try{if(c){var d=a.devicePixelRatio;"useWebkitCSSRenderer"===f.getRenderer()&&(d=1);var r=c.width,s=c.height,
i=a.innerWidth,h=a.innerHeight;m&&(a.innerWidth>a.screen.width&&(i=a.screen.width),a.innerHeight>a.screen.height&&(h=a.screen.height));if(r>i||e.resizeStretch)r=i;if(s>h||e.resizeStretch)s=h;if(p!==r||q!==s)if(k.fitForWidth?(k.widthLimit&&(r=r>k.widthLimit?k.widthLimit:r),w=Math.round(r),x=Math.round(r*c.height/c.width)):(k.heightLimit&&(s=s>k.heightLimit?k.heightLimit:s),w=Math.round(s*c.width/c.height),x=Math.round(s)),b.style.width=l.style.width=w+"px",b.style.height=l.style.height=x+"px",b.width=
l.width=Math.floor(w*d),b.height=l.height=Math.floor(x*d),k.fitForWidth?(v=w/l.width,c.property.clear(),c.fitForWidth(l.width,l.height)):(v=x/l.height,c.property.clear(),c.fitForHeight(l.width,l.height)),p=r,q=s,f.displayDivId){var j=document.getElementById(f.displayDivId);j.style.width=w+"px";j.style.height=x+"px"}var u=a.performance.now(),d=u-D;D=u;f.pausing||(c.exec(d/1E3),c.render());a.requestAnimationFrame(g);0===E%60&&(F=Math.round(6E4/(u-z)),z=u,E=0);if(f.debug||e.debug)document.getElementById("lwf_info"+
e.debugInfoElementId).innerHTML=F+"fps";E++;f.setCurrentFPS(F)}}catch(n){f.handleException_(n,e)}};d=function(b){try{if(C&&b.preventDefault(),c){var a,d,g=l.getBoundingClientRect();if(n){var i=b.touches[0];a=i.pageX;d=i.pageY}else a=b.clientX,d=b.clientY;n?(a-=l.offsetLeft,d-=l.offsetTop,a=a-g.left-window.scrollX,d=d-g.top-window.scrollY):(a-=g.left,d-=g.top);a/=v;d/=v;c.inputPoint(a,d)}}catch(h){f.handleException_(h,e)}};i=function(a){try{if(C&&a.preventDefault(),c){var b,d,g=l.getBoundingClientRect();
if(n){var i=a.touches[0];b=i.pageX;d=i.pageY}else b=a.clientX,d=a.clientY;n?(b-=l.offsetLeft,d-=l.offsetTop,b=b-g.left-window.scrollX,d=d-g.top-window.scrollY):(b-=g.left,d-=g.top);b/=v;d/=v;c.inputPoint(b,d);c.inputPress()}}catch(h){f.handleException_(h,e)}};h=function(b){try{C&&b.preventDefault(),c&&c.inputRelease()}catch(a){f.handleException_(a,e)}};u=function(b){try{c&&a.location.reload(!0)}catch(d){f.handleException_(d,e)}};a.requestAnimationFrame(g);n?(m&&(y||/ SC-0/.test(j))&&document.body.addEventListener("touchstart",
function(){}),t&&(f.debug||e.debug)&&b.addEventListener("gestureend",u,!1),b.addEventListener("touchmove",d,!1),b.addEventListener("touchstart",i,!1),b.addEventListener("touchend",h,!1)):(b.addEventListener("mousemove",d,!1),b.addEventListener("mousedown",i,!1),b.addEventListener("mouseup",h,!1));_.each(e.buttonEventMap,function(b,a){_.isFunction(b)?b={release:b}:_.each(b,function(b,c){if(!_.isFunction(b))throw Error("button event ["+c+"@"+a+"] is not a function!");});c.setButtonEventHandler(a,b)});
var A={},B=function(b,c){A.hasOwnProperty(b)||(A[b]=[]);A[b].push(c)};_.isObject(e.fsCommandMap)&&_.each(e.fsCommandMap,function(b,c){_.isFunction(b)&&B(c,b)});_.isObject(e.pageTransitionMap)&&_.each(e.pageTransitionMap,function(b,c){_.isString(b)?B(c,function(){document.location.href=b}):_.isFunction(b)&&B(c,function(){b(c)})});B=null;_.each(A,function(b,a){c.setEventHandler(a,function(c,a){for(var d=b.length,e=0;e<d;++e)b[e](c,a)})});A=null}else f.handleLoadError_(this,e)};h.prototype.playLWF=function(c,
h){var e=c.getAttribute("data-lwf-display_setting");e&&(e=JSON.parse(e),this.setDisplaySetting(e));e=a.LWF;this.getRenderer()||this.setRenderer(a.Utility.getRenderer());var f=this.getRenderer();if(f)e[f]();else throw Error("Renderer parameters are not properly set");e=e.ResourceCache.get();this.debug&&(a.LWFLOADER_ENABLE_DEBUG=!0);var b=_.isObject(a.lwfDefaultParam)?_.clone(a.lwfDefaultParam):{};b.onload=this.onLoad;this.backgroundColor?b.setBackgroundColor=this.backgroundColor:b.useBackgroundColor=
!0;b.fitForHeight=!1;b.fitForWidth=!1;"fitForWidth"===this.resizeMode?b.fitForWidth=!0:"fitForHeight"===this.resizeMode&&(b.fitForHeight=!0);b.resizeStretch=this.resizeStretch;b.widthLimit=this.widthLimit;b.heightLimit=this.heightLimit;b.worker=p;m&&(/ SC-0/.test(j)&&"useWebkitCSSRenderer"===f)&&(b.quirkyClearRect=!0);m&&(b.use3D=!1);b.privateData={};b.pos=null;b.imageMap={};b.soundMap={};b.pageTransitionMap={};b.buttonEventMap={};b.fsCommandMap={};b.handler={};b.callback={};b.lwfMap=null;for(var g=
0;g<c.attributes.length;g++){var d=c.attributes[g];if(d.name&&0===d.name.indexOf("data-lwf-")){var i=d.name.slice(9),i=i.replace(/_./g,function(b){return b.charAt(1).toUpperCase()});if("displaySetting"!==i){d=d.value;try{"{"===d.charAt(0)&&(d=JSON.parse(d))}catch(t){}b[i]=d}}}2===a.devicePixelRatio&&b.useHighResImage&&(b.imageSuffix="_@2x");b.hasOwnProperty("lwf")||(g=c.getAttribute("data-lwf"),_.isString(g)&&(b.lwf=g));b.hasOwnProperty("name")&&(b.lwf=b.name);_.isObject(h)&&_.extend(b,h);0<this.initializeHooks.length&&
_.each(this.initializeHooks,_.bind(function(a){if(_.isFunction(a)){a=a.call(this,c);for(var d in a)a.hasOwnProperty(d)&&_.extend(b[d],a[d])}},this));this.initializeHooks=[];if(!b.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");g={};g.debugInfoElementId=++z;g.setting=b;g.loader=this;g.debug=!1;g.soundMap=null;g.pageTransitionMap=null;g.buttonEventMap=null;g.fsCommandMap=null;g.handler=null;g.callback=null;g.stageEventReceiver=null;g.lwfMap=null;g.debug=this.debug;b.privateData.hasOwnProperty("lwfLoader")||
(b.privateData.lwfLoader=this);b.imageMap=this.getImageMapper_(b.imageMap);_.isEmpty(b.soundMap)||(g.soundMap=b.soundMap);delete b.soundMap;_.isObject(b.pageTransitionMap)&&(g.pageTransitionMap=b.pageTransitionMap);delete b.pageTransitionMap;g.buttonEventMap=b.buttonEventMap;delete b.buttonEventMap;_.isEmpty(b.fsCommandMap)||(g.fsCommandMap=b.fsCommandMap);delete b.fsCommandMap;_.isEmpty(b.handler)||(g.handler=b.handler);delete b.handler;g.callback=b.callback;delete b.callback;g.lwfMap=b.lwfMap;delete b.lwfMap;
g.resizeStretch=b.resizeStretch;delete b.resizeStretch;this.isLwfsEnvironment_()&&(i=b.prefix?b.prefix+b.lwf:b.lwf,b.prefix=i.slice(0,i.lastIndexOf("/")+1),delete b.imagePrefix,b.lwf=i.slice(i.lastIndexOf("/")+1));i={position:"absolute",top:0,left:0};_.extend(i,b.pos);delete b.pos;if("static"===c.style.position||""===c.style.position)c.style.position="relative";f=q(f);f.style.position=i.position;f.style.top=i.top+"px";f.style.left=i.left+"px";f.style.zIndex=c.style.zIndex+1;c.appendChild(f);d=null;
n?(d=document.createElement("div"),d.style.position="absolute",d.style.top=i.top+"px",d.style.left=i.left+"px",d.style.zIndex=f.style.zIndex+1,c.appendChild(d)):d=f;b.stage=f;g.stageEventReceiver=d;if(this.debug||g.debug)f=document.createElement("div"),f.id="lwf_info"+z,f.style.position=i.position,f.style.top=i.top+"px",f.style.left=i.left+"px",f.style.color="white",f.style.zIndex=1E4,c.appendChild(f);if(b.lwf){g.useLwfJs=/\.lwf.js(\?.*)?$/.test(b.lwf);if(b.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");
b.privateData._loaderData=g;e.loadLWF(b)}else console.error("[LWF] no LWF input")};h.prototype.requestLWF_=function(c,a,e,f,b){var g={};if(this.isLwfsEnvironment_()){var d=_.clone(window.testlwf_settings);d.prefix?g=d.prefix+a+"/_/":(g=document.location.pathname,g=g.replace(c.name,a),g=g.slice(0,g.lastIndexOf("/")+1)+"_/");d.prefix=g;delete d.imagePrefix;g=this.getLwfPath_(a);if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;d.lwf=g;m&&(d.lwf+=".js");d.parentLWF=c;d.stage=
c.stage;d.worker=p;d.active=!1;e&&(d.imageMap=this.getImageMapper_(e));f&&(d.privateData=f);d.onload=function(a){var c=this.privateData.lwfLoader;return!a?(c.handleLoadError_(this),b(this.error,a)):b(null,a)}}else{d=c.privateData;if("undefined"===typeof d)return console.error("[LWF] Parent private data is not found"),b("no parents data found",null),null;var i=_.clone(d._loaderData);if("undefined"===typeof i)return console.error("[LWF] Parent Loader data is not found"),b("no loader parameters to inherit"),
null;d=_.clone(i.setting);d.fitForHeight=d.fitForWidth=!1;i.setting=d;g=null;try{g=this.getLwfMapper_(i)(a)}catch(h){this.handleException_(h,i)}if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;d.lwf=g;i.useLwfJs&&(d.lwf+=".js");d.parentLWF=c;d.stage=c.stage;d.worker=p;d.active=!1;e&&(d.imageMap=this.getImageMapper_(e));f&&(f._loaderData=i,d.privateData=f,f.prefix&&(d.prefix=f.prefix),f.imagePrefix&&(d.imagePrefix=f.imagePrefix));d.onload=function(a){var c=i.loader;return!a?
(c.handleLoadError_(this,i),b(this.error,a)):b(null,a)}}return d};h.prototype.requestLWF=function(a,h,e,f,b){a=this.requestLWF_(a,h,e,f,b);_.isNull(a)||this.requests.push(a)};h.prototype.loadLWFs=function(c){a.LWF.ResourceCache.get().loadLWFs(this.requests,c);this.requests=[]};h.prototype.loadLWF=function(c,h,e,f,b){c=this.requestLWF_(c,h,e,f,b);_.isNull(c)||a.LWF.ResourceCache.get().loadLWF(c)};a.LwfLoader=h})(window);
