window.Utility={};window.Utility.autoSelectRenderer=function(){var b=navigator.userAgent;return/iP(ad|hone|od).*OS 4/.test(b)||(/Android 2\.1/.test(b)||/Android 2\.3\.[5-7]/.test(b))||/Android 4/.test(b)&&!/Chrome/.test(b)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(b){var x=["log","warn","error"],h=b.console.log,u=b.console.warn,y=b.console.error,v={log:function(){if(b.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var j="",a=["privateData","data","url","width","height"],l=0;l<arguments.length;l++){var f="",d;for(d in arguments[l])-1!==a.indexOf(d)&&(f+=d+"="+arguments[l][d]+"\n");j+=f}arguments[0]=arguments[0].replace(/%o/,j)}return h.apply(b.console,arguments)}},warn:function(){if(b.LWFLOADER_ENABLE_DEBUG)return u.apply(b.console,
arguments)},error:function(){if(b.LWFLOADER_ENABLE_DEBUG)return y.apply(b.console,arguments)}},j,A,t;j=0;for(A=x.length;j<A;++j)t=x[j],b.console[t]=v[t]})(window);
(function(b){function x(a){a="useCanvasRenderer"===a||"useWebGLRenderer"===a?document.createElement("canvas"):document.createElement("div");a.width=a.height=0;return a}function h(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;this.resizeMode=this.backgroundColor=null;this.fitToScreen=!1;this.displayDivId=null;this.screenHeight=this.screenWidth=this.stageHeight=this.stageWidth=0;this.stageVAlign=this.stageHAlign=-1;this.useLargeImage=!1;this.isPreventDefaultEnabled=
y||/Android *(4|3)\..*/.test(u);this.rootOffset={x:0,y:0};var a=null,b=0;this.getRenderer=function(){return a};this.setRenderer=function(f){if(a)throw Error("cannot use multiple renderer! LWF has been initialized for "+a+" renderer.");"canvas"===f?f="useCanvasRenderer":"webkitcss"===f?f="useWebkitCSSRenderer":"webgl"===f&&(f="useWebGLRenderer");f&&f.match(/use.+Renderer/i)&&(a=f)};this.getCurrentFPS=function(){isNaN(b)&&console.error("[LWF] FPS is not properly defined");return b};this.setCurrentFPS=
function(a){isNaN(a)&&console.error("[LWF] FPS is not properly defined");b=a};return this}var u=navigator.userAgent,y=/iP(ad|hone|od)/.test(u),v=/Android/.test(u),j=y||v,A=/Chrome/.test(u),t=!v||A,z=0;"undefined"===typeof b.performance&&(b.performance={});b.performance.now=b.performance.now||b.performance.webkitNow||b.performance.mozNow||b.performance.oNow||b.performance.msNow||Date.now;b.requestAnimationFrame=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||
b.msRequestAnimationFrame;(void 0===b.requestAnimationFrame||/iP(ad|hone|od).*OS 6/.test(u))&&function(){var a=1E3/60,l=b.performance.now();b.requestAnimationFrame=function(f){var d=b.performance.now()-l;return b.setTimeout(function(){l=b.performance.now();f()},a-(d>a?d%a:d))}}();h.prototype.isLwfsEnvironment_=function(){return b.testlwf_settings&&!this.isLwfsLoaderEnvironment_()};h.prototype.isLwfsLoaderEnvironment_=function(){return b.lwfs_loader_mode};h.prototype.setPreventDefaultBehaviour=function(a){this.isPreventDefaultEnabled=
a};h.prototype.addInitializeHook=function(a){_.isFunction(a)&&this.initializeHooks.push(a)};h.prototype.pause=function(){this.pausing=!0};h.prototype.resume=function(){this.pausing=!1};h.prototype.getLwfMapper_=function(a){if(null===a.lwfMap)return _.bind(this.getLwfPath_,this);var b=a.lwfMap;if(_.isObject(b))return _.isFunction(b)?b:function(a){var d=a;b.hasOwnProperty(a)&&(d=b[a]);/\.lwf$/.test(d)||(d+=".lwf");return d};throw Error("unsupported lwfMap");};h.prototype.getLwfPath_=function(a){var b=
a;0<=a.indexOf("/")&&(b=a.substring(a.lastIndexOf("/")+1));return this.isLwfsEnvironment_()||this.isLwfsLoaderEnvironment_()?b+".lwf":a+"/_/"+b+".lwf"};h.prototype.getImageMapper_=function(a){return _.isFunction(a)?a:function(b){return a[b]?a[b]:b}};h.prototype.setDisplaySetting=function(a){a.renderer&&this.setRenderer(a.renderer);this.resizeMode=a.resizeMode||this.resizeMode;this.displayDivId=a.displayDivId||this.displayDivId;this.stageWidth=a.stageWidth||this.stageWidth;this.stageHeight=a.stageHeight||
this.stageHeight;this.screenWidth=a.screenWidth||this.screenWidth;this.screenHeight=a.screenHeight||this.screenHeight;this.stageHAlign=null!=a.stageHAlign?a.stageHAlign:this.stageHAlign;this.stageVAlign=null!=a.stageVAlign?a.stageVAlign:this.stageVAlign;this.useLargeImage=a.useLargeImage||this.useLargeImage};h.prototype.handleException_=function(a,b){var f=b.pageTransitionMap,d=null;f.hasOwnProperty("error")?d=f.error:0<_.size(f)&&(d=_.find(f,function(){return!0}));f=b.handler;null===f||void 0===
f.exception?confirm("LWF exception. \n"+a.stack+"\n reload?")&&location.reload():_.isFunction(f.exception)&&f.exception(a,d);console.error("[LWF] exception: %s",a.stack)};h.prototype.handleLoadError_=function(a,b){var f=b.pageTransitionMap,d=null;f.hasOwnProperty("error")?0<_.size(f)&&(d=_.find(f,function(){return!0})):d=f.error;f=b.handler;null===f||void 0===f.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(f.loadError)&&f.loadError(a,d);console.error("[LWF] load error: %o",
a.error);console.error("[LWF] loaded count: %d/%d",a.loadedCount,a.total)};h.prototype.onLoad=function(a){var l=this,f=l.privateData._loaderData,d=f.loader,c=f.stageEventReceiver;l.privateData=null;if(a){if(_.isFunction(f.callback.onLoad))f.callback.onLoad(a);var g,e,m,h,B,i=this.stage,t=0,x=0,w=1,r=0,s=0,E=b.performance.now(),F=0,z=E,G=0;a.rootMovie.moveTo(d.rootOffset.x,d.rootOffset.y);a.width=d.stageWidth?d.stageWidth:a.width;a.height=d.stageHeight?d.stageHeight:a.height;b.lwfWidth=a.width;b.lwfHeight=
a.height;var H=b.devicePixelRatio;"useWebkitCSSRenderer"===d.getRenderer()&&(H=1);g=function(){try{if(a){var e=d.stageWidth?d.stageWidth:a.width,p=d.stageHeight?d.stageHeight:a.height,n=d.screenWidth?d.screenWidth:b.innerWidth,q=d.screenHeight?d.screenHeight:b.innerHeight,h=n/q,m=e/p;v&&(b.innerWidth>b.screen.width&&(n=b.screen.width),b.innerHeight>b.screen.height&&(q=b.screen.height));e>n&&(p*=n/e,e=n);p>q&&(e*=q/p,p=q);if(t!==n||x!==q){r=e;s=p;l.fitForWidth?(r=Math.round(n),s=Math.round(n*p/e)):
l.fitForHeight?(r=Math.round(q*e/p),s=Math.round(q)):f.fitToScreen&&(h>m?(r=e*(q/p),s=q):(r=n,s=p*(n/e)));p=e=0;e=-1==d.stageHAlign?0:1==d.stageHAlign?Math.round(n-r):Math.round((n-r)/2);p=-1==d.stageVAlign?0:1==d.stageVAlign?Math.round(q-s):Math.round((q-s)/2);i.width=d.stageWidth?d.stageWidth:i.width;i.height=d.stageHeight?d.stageHeight:i.height;c.style.left=i.style.left=e+"px";c.style.top=i.style.top=p+"px";c.style.width=i.style.width=r+"px";c.style.height=i.style.height=s+"px";c.width=i.width=
Math.floor(r*H);c.height=i.height=Math.floor(s*H);f.fitToScreen?h<m?(w=r/i.width,a.property.clear(),a.fitForWidth(i.width,i.height)):(w=s/i.height,a.property.clear(),a.fitForHeight(i.width,i.height)):l.fitForWidth?(w=r/i.width,a.property.clear(),a.fitForWidth(i.width,i.height)):(w=s/i.height,a.property.clear(),a.fitForHeight(i.width,i.height));a.property.moveTo(0,0);if(d.displayDivId){var j=document.getElementById(d.displayDivId);f.fitToScreen?(j.style.width=n+"px",j.style.height=q+"px"):(j.style.width=
r+"px",j.style.height=s+"px")}t=n;x=q}var k=b.performance.now(),n=k-E;E=k;d.pausing||(a.exec(n/1E3),a.render());b.requestAnimationFrame(g);0===F%60&&(G=Math.round(6E4/(k-z)),z=k,F=0);if(d.debug||f.debug)document.getElementById("lwf_info"+f.debugInfoElementId).innerHTML=G+"fps";F++;d.setCurrentFPS(G)}}catch(B){d.handleException_(B,f)}};e=function(c){try{if(d.isPreventDefaultEnabled&&c.preventDefault(),a){var b,e,g=i.getBoundingClientRect();if(j){var h=c.touches[0];b=h.pageX;e=h.pageY}else b=c.clientX,
e=c.clientY;j?(b=b-g.left-window.scrollX,e=e-g.top-window.scrollY):(b-=g.left,e-=g.top);b/=w;e/=w;a.inputPoint(b,e)}}catch(l){d.handleException_(l,f)}};m=function(c){try{if(d.isPreventDefaultEnabled&&c.preventDefault(),a){var b,e,g=i.getBoundingClientRect();if(j){var h=c.touches[0];b=h.pageX;e=h.pageY}else b=c.clientX,e=c.clientY;j?(b=b-g.left-window.scrollX,e=e-g.top-window.scrollY):(b-=g.left,e-=g.top);b/=w;e/=w;a.inputPoint(b,e);a.inputPress()}}catch(l){d.handleException_(l,f)}};h=function(c){try{d.isPreventDefaultEnabled&&
c.preventDefault(),a&&a.inputRelease()}catch(b){d.handleException_(b,f)}};B=function(c){try{a&&b.location.reload(!0)}catch(e){d.handleException_(e,f)}};b.requestAnimationFrame(g);j?(v&&(A||/ SC-0/.test(u))&&document.body.addEventListener("touchstart",function(){}),y&&(d.debug||f.debug)&&c.addEventListener("gestureend",B,!1),c.addEventListener("touchmove",e,!1),c.addEventListener("touchstart",m,!1),c.addEventListener("touchend",h,!1)):(c.addEventListener("mousemove",e,!1),c.addEventListener("mousedown",
m,!1),c.addEventListener("mouseup",h,!1));_.each(f.buttonEventMap,function(c,b){_.isFunction(c)?c={release:c}:_.each(c,function(a,c){if(!_.isFunction(a))throw Error("button event ["+c+"@"+b+"] is not a function!");});a.setButtonEventHandler(b,c)});var C={},D=function(a,c){C.hasOwnProperty(a)||(C[a]=[]);C[a].push(c)};_.isObject(f.fsCommandMap)&&_.each(f.fsCommandMap,function(a,c){_.isFunction(a)&&D(c,a)});_.isObject(f.pageTransitionMap)&&_.each(f.pageTransitionMap,function(a,c){_.isString(a)?D(c,function(){document.location.href=
a}):_.isFunction(a)&&D(c,function(){a(c)})});D=null;_.each(C,function(c,b){a.setEventHandler(b,function(a,b){for(var d=c.length,e=0;e<d;++e)c[e](a,b)})});C=null}else d.handleLoadError_(this,f)};h.prototype.playLWF=function(a,h){var f=a.getAttribute("data-lwf-display_setting");f&&(f=JSON.parse(f),this.setDisplaySetting(f));f=b.LWF;this.getRenderer()||this.setRenderer(b.Utility.autoSelectRenderer());var d=this.getRenderer();if(d)f[d]();else throw Error("Renderer parameters are not properly set");f=
f.ResourceCache.get();this.debug&&(b.LWFLOADER_ENABLE_DEBUG=!0);var c={};c.onload=this.onLoad;this.backgroundColor?c.setBackgroundColor=this.backgroundColor:c.useBackgroundColor=!0;c.fitForHeight=!1;c.fitForWidth=!1;"fitForWidth"===this.resizeMode?c.fitForWidth=!0:"fitForHeight"===this.resizeMode?c.fitForHeight=!0:"fitToScreen"===this.resizeMode&&(this.fitToScreen=!0);c.fitToScreen=this.fitToScreen;c.worker=t;v&&(/ (SC-0|Galaxy Nexus)/.test(u)&&"useWebkitCSSRenderer"===d)&&(c.quirkyClearRect=!0);
v&&(c.use3D=!1);c.privateData={};c.pos=null;c.imageMap={};c.soundMap={};c.pageTransitionMap={};c.buttonEventMap={};c.fsCommandMap={};c.handler={};c.callback={};c.lwfMap=null;for(var g=function(a){return a.charAt(1).toUpperCase()},e=0;e<a.attributes.length;e++){var m=a.attributes[e];if(m.name&&0===m.name.indexOf("data-lwf-")){var k=m.name.slice(9),k=k.replace(/_./g,g);if("displaySetting"!==k){m=m.value;try{"{"===m.charAt(0)&&(m=JSON.parse(m))}catch(B){}c[k]=m}}}2===b.devicePixelRatio&&this.useLargeImage&&
(c.imageSuffix="_@2x");c.hasOwnProperty("lwf")||(g=a.getAttribute("data-lwf"),_.isString(g)&&(c.lwf=g));c.hasOwnProperty("name")&&(c.lwf=c.name);_.isObject(h)&&_.extend(c,h);0<this.initializeHooks.length&&_.each(this.initializeHooks,_.bind(function(b){if(_.isFunction(b)){b=b.call(this,a);for(var d in b)b.hasOwnProperty(d)&&_.extend(c[d],b[d])}},this));this.initializeHooks=[];if(!c.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");g={};g.debugInfoElementId=++z;g.setting=c;g.loader=this;g.debug=
!1;g.soundMap=null;g.pageTransitionMap=null;g.buttonEventMap=null;g.fsCommandMap=null;g.handler=null;g.callback=null;g.stageEventReceiver=null;g.lwfMap=null;g.debug=this.debug;c.privateData.hasOwnProperty("lwfLoader")||(c.privateData.lwfLoader=this);c.imageMap=this.getImageMapper_(c.imageMap);_.isEmpty(c.soundMap)||(g.soundMap=c.soundMap);delete c.soundMap;_.isObject(c.pageTransitionMap)&&(g.pageTransitionMap=c.pageTransitionMap);delete c.pageTransitionMap;g.buttonEventMap=c.buttonEventMap;delete c.buttonEventMap;
_.isEmpty(c.fsCommandMap)||(g.fsCommandMap=c.fsCommandMap);delete c.fsCommandMap;_.isEmpty(c.handler)||(g.handler=c.handler);delete c.handler;g.callback=c.callback;delete c.callback;g.lwfMap=c.lwfMap;delete c.lwfMap;g.fitToScreen=c.fitToScreen;delete c.fitToScreen;this.isLwfsEnvironment_()&&(e=c.prefix?c.prefix+c.lwf:c.lwf,c.prefix=e.slice(0,e.lastIndexOf("/")+1),delete c.imagePrefix,c.lwf=e.slice(e.lastIndexOf("/")+1));e={position:"absolute",top:0,left:0};_.extend(e,c.pos);delete c.pos;if("static"===
a.style.position||""===a.style.position)a.style.position="relative";d=x(d);d.style.position=e.position;d.style.top=e.top+"px";d.style.left=e.left+"px";d.style.zIndex=a.style.zIndex+1;a.appendChild(d);k=null;j?(k=document.createElement("div"),k.style.position="absolute",k.style.top=e.top+"px",k.style.left=e.left+"px",k.style.zIndex=d.style.zIndex+1,a.appendChild(k)):k=d;c.stage=d;g.stageEventReceiver=k;if(this.debug||g.debug)d=document.createElement("div"),d.id="lwf_info"+z,d.style.position=e.position,
d.style.top=e.top+"px",d.style.left=e.left+"px",d.style.color="white",d.style.zIndex=1E4,a.appendChild(d);if(c.lwf){g.useLwfJs=/\.lwf.js(\?.*)?$/.test(c.lwf);if(c.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");c.privateData._loaderData=g;f.loadLWF(c)}else console.error("[LWF] no LWF input")};h.prototype.requestLWF_=function(a,b,f,d,c){var g={};if(this.isLwfsEnvironment_()){var e=_.clone(window.testlwf_settings);e.prefix?g=e.prefix+b+"/_/":(g=
document.location.pathname,g=g.replace(a.name,b),g=g.slice(0,g.lastIndexOf("/")+1)+"_/");e.prefix=g;delete e.imagePrefix;g=this.getLwfPath_(b);if(!g)return console.error("[LWF] no LWF input"),c("no LWF input",null),null;e.lwf=g;e.parentLWF=a;e.stage=a.stage;e.worker=t;e.active=!1;f&&(e.imageMap=this.getImageMapper_(f));d&&(e.privateData=d);e.onload=function(a){var b=this.privateData.lwfLoader;return!a?(b.handleLoadError_(this),c(this.error,a)):c(null,a)}}else{e=a.privateData;if("undefined"===typeof e)return console.error("[LWF] Parent private data is not found"),
c("no parents data found",null),null;var h=_.clone(e._loaderData);if("undefined"===typeof h)return console.error("[LWF] Parent Loader data is not found"),c("no loader parameters to inherit"),null;e=_.clone(h.setting);e.fitForHeight=e.fitForWidth=!1;h.setting=e;if(this.isLwfsLoaderEnvironment_())g=document.location.pathname,g=g.replace(a.name,b),g=g.slice(0,g.lastIndexOf("/")+1)+"_/",e.prefix=g,delete e.imagePrefix,g=this.getLwfPath_(b);else{g=null;try{g=this.getLwfMapper_(h)(b)}catch(j){this.handleException_(j,
h)}}if(!g)return console.error("[LWF] no LWF input"),c("no LWF input",null),null;e.lwf=g;h.useLwfJs&&(e.lwf+=".js");e.parentLWF=a;e.stage=a.stage;e.worker=t;e.active=!1;f&&(e.imageMap=this.getImageMapper_(f));d&&(d._loaderData=h,e.privateData=d,d.prefix&&(e.prefix=d.prefix),d.imagePrefix&&(e.imagePrefix=d.imagePrefix));e.onload=function(a){var b=h.loader;return!a?(b.handleLoadError_(this,h),c(this.error,a)):c(null,a)}}return e};h.prototype.requestLWF=function(a,b,f,d,c){a=this.requestLWF_(a,b,f,d,
c);_.isNull(a)||this.requests.push(a)};h.prototype.loadLWF=function(a,h,f,d,c){a=this.requestLWF_(a,h,f,d,c);_.isNull(a)||b.LWF.ResourceCache.get().loadLWF(a)};h.prototype.loadLWFs=function(a){b.LWF.ResourceCache.get().loadLWFs(this.requests,a);this.requests=[]};b.LwfLoader=h})(window);
