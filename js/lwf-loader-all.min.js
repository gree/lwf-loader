window.Utility={};window.Utility.addVirtualTouchEnd=function(a,p,g){var j=null,s=0,m=0;a.addEventListener("touchstart",function(a){a.preventDefault();a.changedTouches&&a.changedTouches[0]&&(j=a.changedTouches[0],s=j.clientX,m=j.clientY)},g);a.addEventListener("touchend",function(a){a.preventDefault();if(null!==j){if(j&&a.changedTouches&&a.changedTouches[0]){var g=s-a.changedTouches[0].clientX,k=m-a.changedTouches[0].clientY;if(400<g*g+k*k)return}j=null;p(a)}},g)};
window.Utility.getRenderer=function(){var a=navigator.userAgent;return/Android 2\.1/.test(a)||/Android 4/.test(a)&&!/Chrome/.test(a)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(a){var p=["log","warn","error"],g=a.console.log,j=a.console.warn,s=a.console.error,m={log:function(){if(a.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var j="",m=["privateData","data","url","width","height"],c=0;c<arguments.length;c++){var t="",f;for(f in arguments[c])-1!==m.indexOf(f)&&(t+=f+"="+arguments[c][f]+"\n");j+=t}arguments[0]=arguments[0].replace(/%o/,j)}return g.apply(a.console,arguments)}},warn:function(){if(a.LWFLOADER_ENABLE_DEBUG)return j.apply(a.console,
arguments)},error:function(){if(a.LWFLOADER_ENABLE_DEBUG)return s.apply(a.console,arguments)}},n,x,k;n=0;for(x=p.length;n<x;++n)k=p[n],a.console[k]=m[k]})(window);
(function(a){function p(c){c="useCanvasRenderer"===c||"useWebGLRenderer"===c?document.createElement("canvas"):document.createElement("div");c.width=c.height=0;return c}function g(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;this.currentFPS=0;this.backgroundColor=null;this.resizeMode="fitForWidth";this.displayDivId=this.resizeStretch=null;this.heightLimit=this.widthLimit=0;this.rootOffset={x:0,y:0};var c=null;this.getRenderer=function(){return c};this.setRenderer=
function(a){if(c)throw Error("cannot use multiple renderer! LWF has been initialized for "+c+" renderer.");"canvas"===a?a="useCanvasRenderer":"webkitcss"===a?a="useWebkitCSSRenderer":"webgl"===a&&(a="useWebGLRenderer");a&&a.match(/use.+Renderer/i)&&(c=a)};return this}var j=navigator.userAgent,s=/iPhone/.test(j)||/iPod/.test(j)||/iPad/.test(j),m=/Android/.test(j),n=s||m,x=/Chrome/.test(j),k=!m||x,C=/(iPhone|iPad)/.test(j)||/Android *(4|3)\..*/.test(j),y=0;"undefined"===typeof a.performance&&(a.performance=
{});a.performance.now=a.performance.now||a.performance.webkitNow||a.performance.mozNow||a.performance.oNow||a.performance.msNow||Date.now;a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame;void 0===a.requestAnimationFrame&&function(){var c=1E3/60,t=a.performance.now();a.requestAnimationFrame=function(f){var e=a.performance.now()-t;return a.setTimeout(function(){t=a.performance.now();f()},c-
(e>c?e%c:e))}}();g.prototype.isLwfsEnvironment_=function(){return a.testlwf_lwf};g.prototype.getCurrentFPS=function(){isNaN(this.currentFPS)&&console.error("[LWF] FPS is not properly defined");return this.currentFPS};g.prototype.addInitializeHook=function(c){_.isFunction(c)&&this.initializeHooks.push(c)};g.prototype.pause=function(){this.pausing=!0};g.prototype.resume=function(){this.pausing=!1};g.prototype.getLwfMapper_=function(c){if(null===c.lwfMap)return _.bind(this.getLwfPath_,this);var a=c.lwfMap;
if(_.isObject(a))return _.isFunction(a)?a:function(c){var e=c;a.hasOwnProperty(c)&&(e=a[c]);/\.lwf$/.test(e)||(e+=".lwf");return e};throw Error("unsupported lwfMap");};g.prototype.getLwfPath_=function(c){var a=c;0<=c.indexOf("/")&&(a=c.substring(c.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?a+".lwf":c+"/_/"+a+".lwf"};g.prototype.getImageMapper_=function(c){return _.isFunction(c)?c:function(a){return c[a]?c[a]:a}};g.prototype.setDisplaySetting_=function(c){this.setRenderer(c.renderer);this.resizeMode=
c.resizeMode||this.resizeMode;this.resizeStretch=c.resizeStretch||this.resizeStretch;this.displayDivId=c.displayDivId||this.displayDivId;this.widthLimit=c.widthLimit||this.widthLimit;this.heightLimit=c.heightLimit||this.heightLimit};g.prototype.handleException_=function(c,a){var f=a.pageTransitionMap,e=null;f.hasOwnProperty("error")?e=f.error:0<_.size(f)&&(e=_.find(f,function(){return!0}));f=a.handler;null===f||void 0===f.exception?confirm("LWF exception. \n"+c.stack+"\n reload?")&&location.reload():
_.isFunction(f.exception)&&f.exception(c,e);console.error("[LWF] exception: %s",c.stack)};g.prototype.handleLoadError_=function(c,a){var f=a.pageTransitionMap,e=null;f.hasOwnProperty("error")?0<_.size(f)&&(e=_.find(f,function(){return!0})):e=f.error;f=a.handler;null===f||void 0===f.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(f.loadError)&&f.loadError(c,e);console.error("[LWF] load error: %o",c.error);console.error("[LWF] loaded count: %d/%d",c.loadedCount,c.total)};
g.prototype.onLoad=function(c){var g=this,f=g.privateData._loaderData,e=f.loader,b=f.stageEventReceiver;g.privateData=null;if(c){if(_.isFunction(f.callback.onLoad))f.callback.onLoad(c);var h,d,i,k,z,l=this.stage,p=0,y=0,u=1,v=0,w=0,D=a.performance.now(),E=0,G=D,F=0;c.rootMovie.moveTo(e.rootOffset.x,e.rootOffset.y);h=function(){try{if(c){var d=a.devicePixelRatio;"useWebkitCSSRenderer"===e.getRenderer()&&(d=1);var q=c.width,r=c.height,i=a.innerWidth,j=a.innerHeight;m&&(a.innerWidth>a.screen.width&&
(i=a.screen.width),a.innerHeight>a.screen.height&&(j=a.screen.height));if(q>i||f.resizeStretch)q=i;if(r>j||f.resizeStretch)r=j;if(p!==q||y!==r)if(g.fitForWidth?(g.widthLimit&&(q=q>g.widthLimit?g.widthLimit:q),v=Math.round(q),w=Math.round(q*c.height/c.width)):(g.heightLimit&&(r=r>g.heightLimit?g.heightLimit:r),v=Math.round(r*c.width/c.height),w=Math.round(r)),b.style.width=l.style.width=v+"px",b.style.height=l.style.height=w+"px",b.width=l.width=~~(v*d),b.height=l.height=~~(w*d),g.fitForWidth?(u=v/
l.width,c.property.clear(),c.fitForWidth(l.width,l.height)):(u=w/l.height,c.property.clear(),c.fitForHeight(l.width,l.height)),p=q,y=r,e.displayDivId){var z=document.getElementById(e.displayDivId);z.style.width=v+"px";z.style.height=w+"px"}var k=a.performance.now(),d=k-D;D=k;e.pausing||(c.exec(d/1E3),c.render());a.requestAnimationFrame(h);0===E%60&&(F=Math.round(6E4/(k-G)),G=k,E=0);if(e.debug||f.debug)document.getElementById("lwf_info"+f.debugInfoElementId).innerHTML=F+"fps";E++;e.currentFPS=F}}catch(n){e.handleException_(n,
f)}};d=function(a){try{if(C&&a.preventDefault(),c){var b,d,h=l.getBoundingClientRect();if(n){var g=a.touches[0];b=g.pageX;d=g.pageY}else b=a.clientX,d=a.clientY;n?(b-=l.offsetLeft,d-=l.offsetTop,b=b-h.left-window.scrollX,d=d-h.top-window.scrollY):(b-=h.left,d-=h.top);b/=u;d/=u;c.inputPoint(b,d)}}catch(i){e.handleException_(i,f)}};i=function(b){try{if(C&&b.preventDefault(),c){var a,d,h=l.getBoundingClientRect();if(n){var g=b.touches[0];a=g.pageX;d=g.pageY}else a=b.clientX,d=b.clientY;n?(a-=l.offsetLeft,
d-=l.offsetTop,a=a-h.left-window.scrollX,d=d-h.top-window.scrollY):(a-=h.left,d-=h.top);a/=u;d/=u;c.inputPoint(a,d);c.inputPress()}}catch(i){e.handleException_(i,f)}};k=function(a){try{C&&a.preventDefault(),c&&c.inputRelease()}catch(b){e.handleException_(b,f)}};z=function(b){try{c&&a.location.reload(!0)}catch(d){e.handleException_(d,f)}};a.requestAnimationFrame(h);n?(m&&(x||/ SC-0/.test(j))&&document.body.addEventListener("touchstart",function(){}),s&&(e.debug||f.debug)&&b.addEventListener("gestureend",
z,!1),b.addEventListener("touchmove",d,!1),b.addEventListener("touchstart",i,!1),b.addEventListener("touchend",k,!1)):(b.addEventListener("mousemove",d,!1),b.addEventListener("mousedown",i,!1),b.addEventListener("mouseup",k,!1));_.each(f.buttonEventMap,function(a,b){_.isFunction(a)?a={release:a}:_.each(a,function(a,c){if(!_.isFunction(a))throw Error("button event ["+c+"@"+b+"] is not a function!");});c.setButtonEventHandler(b,a)});var A={},B=function(a,b){A.hasOwnProperty(a)||(A[a]=[]);A[a].push(b)};
_.isObject(f.fsCommandMap)&&_.each(f.fsCommandMap,function(a,b){_.isFunction(a)&&B(b,a)});_.isObject(f.pageTransitionMap)&&_.each(f.pageTransitionMap,function(a,b){_.isString(a)?B(b,function(){document.location.href=a}):_.isFunction(a)&&B(b,function(){a(b)})});B=null;_.each(A,function(a,b){c.setEventHandler(b,function(b,c){for(var d=a.length,e=0;e<d;++e)a[e](b,c)})});A=null}else e.handleLoadError_(this,f)};g.prototype.playLWF=function(c,g){var f=c.getAttribute("data-lwf-display_setting");f&&(f=JSON.parse(f),
this.setDisplaySetting_(f));f=a.LWF;this.getRenderer()||this.setRenderer(a.Utility.getRenderer());var e=this.getRenderer();if(e)f[e]();else throw Error("Renderer parameters are not properly set");f=f.ResourceCache.get();this.debug&&(a.LWFLOADER_ENABLE_DEBUG=!0);var b=_.isObject(a.lwfDefaultParam)?_.clone(a.lwfDefaultParam):{};b.onload=this.onLoad;this.backgroundColor?b.setBackgroundColor=this.backgroundColor:b.useBackgroundColor=!0;b.fitForHeight=!1;b.fitForWidth=!1;"fitForWidth"===this.resizeMode?
b.fitForWidth=!0:"fitForHeight"==this.resizeMode&&(b.fitForHeight=!0);b.resizeStretch=this.resizeStretch;b.widthLimit=this.widthLimit;b.heightLimit=this.heightLimit;b.worker=k;m&&(/ SC-0/.test(j)&&"useWebkitCSSRenderer"===e)&&(b.quirkyClearRect=!0);m&&(b.use3D=!1);b.privateData={};b.pos=null;b.imageMap={};b.soundMap={};b.pageTransitionMap={};b.buttonEventMap={};b.fsCommandMap={};b.handler={};b.callback={};b.lwfMap=null;for(var h=0;h<c.attributes.length;h++){var d=c.attributes[h];if(d.name&&0===d.name.indexOf("data-lwf-")){var i=
d.name.slice(9),i=i.replace(/_./g,function(a){return a.charAt(1).toUpperCase()});if("displaySetting"!==i){d=d.value;try{"{"===d.charAt(0)&&(d=JSON.parse(d))}catch(s){}b[i]=d}}}2==a.devicePixelRatio&&b.useHighResImage&&(b.imageSuffix="_@2x");b.hasOwnProperty("lwf")||(h=c.getAttribute("data-lwf"),_.isString(h)&&(b.lwf=h));b.hasOwnProperty("name")&&(b.lwf=b.name);_.isObject(g)&&_.extend(b,g);0<this.initializeHooks.length&&_.each(this.initializeHooks,_.bind(function(a){if(_.isFunction(a)){a=a.call(this,
c);for(var d in a)a.hasOwnProperty(d)&&_.extend(b[d],a[d])}},this));this.initializeHooks=[];if(!b.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");h={};h.debugInfoElementId=++y;h.setting=b;h.loader=this;h.debug=!1;h.soundMap=null;h.pageTransitionMap=null;h.buttonEventMap=null;h.fsCommandMap=null;h.handler=null;h.callback=null;h.stageEventReceiver=null;h.lwfMap=null;h.debug=this.debug;b.privateData.hasOwnProperty("lwfLoader")||(b.privateData.lwfLoader=this);b.imageMap=this.getImageMapper_(b.imageMap);
_.isEmpty(b.soundMap)||(h.soundMap=b.soundMap);delete b.soundMap;_.isObject(b.pageTransitionMap)&&(h.pageTransitionMap=b.pageTransitionMap);delete b.pageTransitionMap;h.buttonEventMap=b.buttonEventMap;delete b.buttonEventMap;_.isEmpty(b.fsCommandMap)||(h.fsCommandMap=b.fsCommandMap);delete b.fsCommandMap;_.isEmpty(b.handler)||(h.handler=b.handler);delete b.handler;h.callback=b.callback;delete b.callback;h.lwfMap=b.lwfMap;delete b.lwfMap;h.resizeStretch=b.resizeStretch;delete b.resizeStretch;this.isLwfsEnvironment_()&&
(i=b.prefix?b.prefix+b.lwf:b.lwf,b.prefix=i.slice(0,i.lastIndexOf("/")+1),delete b.imagePrefix,b.lwf=i.slice(i.lastIndexOf("/")+1));i={position:"absolute",top:0,left:0};_.extend(i,b.pos);delete b.pos;if("static"===c.style.position||""===c.style.position)c.style.position="relative";e=p(e);e.style.position=i.position;e.style.top=i.top+"px";e.style.left=i.left+"px";e.style.zIndex=c.style.zIndex+1;c.appendChild(e);d=null;n?(d=document.createElement("div"),d.style.position="absolute",d.style.top=i.top+
"px",d.style.left=i.left+"px",d.style.zIndex=e.style.zIndex+1,c.appendChild(d)):d=e;b.stage=e;h.stageEventReceiver=d;if(this.debug||h.debug)e=document.createElement("div"),e.id="lwf_info"+y,e.style.position=i.position,e.style.top=i.top+"px",e.style.left=i.left+"px",e.style.color="white",e.style.zIndex=1E4,c.appendChild(e);if(b.lwf){h.useLwfJs=/\.lwf.js(\?.*)?$/.test(b.lwf);if(b.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");b.privateData._loaderData=
h;f.loadLWF(b)}else console.error("[LWF] no LWF input")};g.prototype.requestLWF_=function(a,g,f,e,b){var h={};if(this.isLwfsEnvironment_()){var d=_.clone(window.testlwf_settings);d.prefix?h=d.prefix+g+"/_/":(h=document.location.pathname,h=h.replace(a.name,g),h=h.slice(0,h.lastIndexOf("/")+1)+"_/");d.prefix=h;delete d.imagePrefix;h=this.getLwfPath_(g);if(!h)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;d.lwf=h;m&&(d.lwf+=".js");d.parentLWF=a;d.stage=a.stage;d.worker=k;d.active=
!1;f&&(d.imageMap=this.getImageMapper_(f));e&&(d.privateData=e);d.onload=function(a){var c=this.privateData.lwfLoader;return!a?(c.handleLoadError_(this),b(this.error,a)):b(null,a)}}else{d=a.privateData;if("undefined"===typeof d)return console.error("[LWF] Parent private data is not found"),b("no parents data found",null),null;var i=_.clone(d._loaderData);if("undefined"===typeof i)return console.error("[LWF] Parent Loader data is not found"),b("no loader parameters to inherit"),null;d=_.clone(i.setting);
d.fitForHeight=d.fitForWidth=!1;i.setting=d;h=null;try{h=this.getLwfMapper_(i)(g)}catch(j){this.handleException_(j,i)}if(!h)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;d.lwf=h;i.useLwfJs&&(d.lwf+=".js");d.parentLWF=a;d.stage=a.stage;d.worker=k;d.active=!1;f&&(d.imageMap=this.getImageMapper_(f));e&&(e._loaderData=i,d.privateData=e,e.prefix&&(d.prefix=e.prefix),e.imagePrefix&&(d.imagePrefix=e.imagePrefix));d.onload=function(a){var c=i.loader;return!a?(c.handleLoadError_(this,
i),b(this.error,a)):b(null,a)}}return d};g.prototype.requestLWF=function(a,g,f,e,b){a=this.requestLWF_(a,g,f,e,b);_.isNull(a)||this.requests.push(a)};g.prototype.loadLWFs=function(c){a.LWF.ResourceCache.get().loadLWFs(this.requests,c);this.requests=[]};g.prototype.loadLWF=function(c,g,f,e,b){c=this.requestLWF_(c,g,f,e,b);_.isNull(c)||a.LWF.ResourceCache.get().loadLWF(c)};a.LwfLoader=g;g.prototype.playLWF=g.prototype.playLWF;g.prototype.loadLWF=g.prototype.loadLWF;g.prototype.addInitializeHook=g.prototype.addInitializeHook;
g.prototype.setRenderer=g.prototype.setRenderer})(window);
