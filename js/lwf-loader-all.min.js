window.LWFLOADER_ENABLE_DEBUG=!0;window.Utility={};window.Utility.addVirtualTouchEnd=function(a,q,f){var j=null,n=0,k=0;a.addEventListener("touchstart",function(a){a.preventDefault();a.changedTouches&&a.changedTouches[0]&&(j=a.changedTouches[0],n=j.clientX,k=j.clientY)},f);a.addEventListener("touchend",function(a){a.preventDefault();if(null!==j){if(j&&a.changedTouches&&a.changedTouches[0]){var f=n-a.changedTouches[0].clientX,h=k-a.changedTouches[0].clientY;if(400<f*f+h*h)return}j=null;q(a)}},f)};
window.Utility.getRenderer=function(){var a=navigator.userAgent;return/Android 2\.1/.test(a)||/Android 4/.test(a)&&!/Chrome/.test(a)?"useWebkitCSSRenderer":"useCanvasRenderer"};
(function(a){var q=["log","warn","error"],f=a.console.log,j=a.console.warn,n=a.console.error,k={log:function(){if(window.LWFLOADER_ENABLE_DEBUG){if(/Android/.test(navigator.userAgent)&&1<arguments.length&&/(%o)/.test(arguments[0])){for(var h="",j=["privateData","data","url","width","height"],k=0;k<arguments.length;k++){var m="",n;for(n in arguments[k])-1!==j.indexOf(n)&&(m+=n+"="+arguments[k][n]+"\n");h+=m}arguments[0]=arguments[0].replace(/%o/,h)}return f.apply(a.console,arguments)}},warn:function(){if(window.LWFLOADER_ENABLE_DEBUG)return j.apply(a.console,
arguments)},error:function(){if(window.LWFLOADER_ENABLE_DEBUG)return n.apply(a.console,arguments)}},m,w,h;m=0;for(w=q.length;m<w;++m)h=q[m],a.console[h]=k[h]})(window);
(function(a){function q(d){d="useCanvasRenderer"===d||"useWebGLRenderer"===d?document.createElement("canvas"):document.createElement("div");d.width=d.height=0;return d}function f(){this.initializeHooks=[];this.requests=[];this.pausing=!1;this.loadingCounter=0;this.debug=!1;return this}var j=navigator.userAgent,n=/iPhone/.test(j)||/iPod/.test(j)||/iPad/.test(j),k=/Android/.test(j),m=n||k,w=/Chrome/.test(j),h=null,r=!k||w,s="fitForWidth",E=/(iPhone|iPad)/.test(j)||/Android *(4|3)\..*/.test(j),I=[],
x=0;"undefined"===typeof a.performance&&(a.performance={});a.performance.now=a.performance.now||a.performance.webkitNow||a.performance.mozNow||a.performance.oNow||a.performance.msNow||Date.now;a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame;void 0===a.requestAnimationFrame&&function(){var d=1E3/60,G=a.performance.now();a.requestAnimationFrame=function(c){var i=a.performance.now()-G;return a.setTimeout(function(){G=
a.performance.now();c()},d-(i>d?i%d:i))}}();f.prototype.isLwfsEnvironment_=function(){return a.testlwf_lwf};f.prototype.addInitializeHook=function(d){_.isFunction(d)&&this.initializeHooks.push(d)};f.prototype.pause=function(){this.pausing=!0};f.prototype.resume=function(){this.pausing=!1};f.prototype.getLwfMapper_=function(d){if(null===d.lwfMap)return _.bind(this.getLwfPath_,this);var a=d.lwfMap;if(_.isObject(a))return _.isFunction(a)?a:function(c){var d=c;a.hasOwnProperty(c)&&(d=a[c]);/\.lwf$/.test(d)||
(d+=".lwf");return d};throw Error("unsupported lwfMap");};f.prototype.getLwfPath_=function(d){var a=d;0<=d.indexOf("/")&&(a=d.substring(d.lastIndexOf("/")+1));return this.isLwfsEnvironment_()?a+".lwf":d+"/_/"+a+".lwf"};f.prototype.getImageMapper_=function(d,a){if(_.isFunction(d))return d;var c=a?"?"+a:"",i=this.isLwfsEnvironment_();return function(b){var a;a=b;a=d[a]?d[a]:null;if(null!==a)return a;if(i)return b;0===b.indexOf("lwf_")?(a=this.lwf,b="lwf/"+a.slice(0,a.lastIndexOf("/")+1)+b):0===b.indexOf("param_")?
(console.error("[LWF] error: no imageMap setting for %s, use dummy image.",b),b="lwf/dummy.png"):b=b.replace(/_/g,"/");return c?b+c:b}};f.prototype.handleException_=function(d,a){var c=a.pageTransitionMap,i=null;c.hasOwnProperty("error")?i=c.error:0<_.size(c)&&(i=_.find(c,function(){return!0}));c=a.handler;null===c||void 0===c.exception?confirm("LWF exception. \n"+d.stack+"\n reload?")&&location.reload():_.isFunction(c.exception)&&c.exception(d,i);console.error("[LWF] exception: %s",d.stack)};f.prototype.handleLoadError_=
function(d,a){var c=a.pageTransitionMap,i=null;c.hasOwnProperty("error")?0<_.size(c)&&(i=_.find(c,function(){return!0})):i=c.error;c=a.handler;null===c||void 0===c.loadError?confirm("LWF load error. \n reload?")&&location.reload():_.isFunction(c.loadError)&&c.loadError(d,i);console.error("[LWF] load error: %o",d.error);console.error("[LWF] loaded count: %d/%d",d.loadedCount,d.total)};f.prototype.onLoad=function(d){var f=this,c=f.privateData._loaderData,i=c.loader,b=c.stageEventReceiver;f.privateData=
null;if(d){I.push(d);if(_.isFunction(c.callback.onLoad))c.callback.onLoad(d);var g,e,B,p,C,l=this.stage,q=0,s=0,t=1,y=0,z=0,r=a.performance.now(),F=0,x=r,H=0;d.rootMovie.moveTo(0,0);g=function(){try{if(d){var e=a.devicePixelRatio;"useWebkitCSSRenderer"===h&&(e=1);var u=d.width,v=d.height;u>a.innerWidth&&(u=a.innerWidth);v>a.innerHeight&&(v=a.innerHeight);if(q!==u||s!==v)f.fitForWidth?(y=Math.round(u),z=Math.round(u*d.height/d.width)):(y=Math.round(v*d.width/d.height),z=Math.round(v)),b.style.width=
l.style.width=y+"px",b.style.height=l.style.height=z+"px",b.width=l.width=~~(y*e),b.height=l.height=~~(z*e),f.fitForWidth?(t=y/l.width,d.property.clear(),d.fitForWidth(l.width,l.height)):(t=z/l.height,d.property.clear(),d.fitForHeight(l.width,l.height)),q=u,s=v;var j=a.performance.now(),e=j-r;r=j;i.pausing||(d.exec(e/1E3),d.render());a.requestAnimationFrame(g);if(i.debug||c.debug)0===F%60&&(H=Math.round(6E4/(j-x)),x=j,F=0),document.getElementById("lwf_info"+c.debugInfoElementId).innerHTML=H+"fps",
F++}}catch(C){i.handleException_(C,c)}};e=function(b){try{if(E&&b.preventDefault(),d){var a,e,g=l.getBoundingClientRect();if(m){var f=b.touches[0];a=f.pageX;e=f.pageY}else a=b.offsetX,e=b.offsetY;m&&(a-=l.offsetLeft,e-=l.offsetTop,a=a-g.left-window.scrollX,e=e-g.top-window.scrollY);a/=t;e/=t;d.inputPoint(a,e)}}catch(h){i.handleException_(h,c)}};B=function(b){try{if(E&&b.preventDefault(),d){var a,e,g=l.getBoundingClientRect();if(m){var f=b.touches[0];a=f.pageX;e=f.pageY}else a=b.offsetX,e=b.offsetY;
m&&(a-=l.offsetLeft,e-=l.offsetTop,a=a-g.left-window.scrollX,e=e-g.top-window.scrollY);a/=t;e/=t;d.inputPoint(a,e);d.inputPress()}}catch(h){i.handleException_(h,c)}};p=function(b){try{E&&b.preventDefault(),d&&d.inputRelease()}catch(a){i.handleException_(a,c)}};C=function(b){try{d&&a.location.reload(!0)}catch(e){i.handleException_(e,c)}};a.requestAnimationFrame(g);m?(k&&(w||/ SC-0/.test(j))&&document.body.addEventListener("touchstart",function(){}),n&&(i.debug||c.debug)&&b.addEventListener("gestureend",
C,!1),b.addEventListener("touchmove",e,!1),b.addEventListener("touchstart",B,!1),b.addEventListener("touchend",p,!1)):(b.addEventListener("mousemove",e,!1),b.addEventListener("mousedown",B,!1),b.addEventListener("mouseup",p,!1));_.each(c.buttonEventMap,function(b,a){_.isFunction(b)?b={release:b}:_.each(b,function(b,d){if(!_.isFunction(b))throw Error("button event ["+d+"@"+a+"] is not a function!");});d.setButtonEventHandler(a,b)});var A={},D=function(b,a){A.hasOwnProperty(b)||(A[b]=[]);A[b].push(a)};
_.isObject(c.fsCommandMap)&&_.each(c.fsCommandMap,function(b,a){_.isFunction(b)&&D(a,b)});_.isObject(c.pageTransitionMap)&&_.each(c.pageTransitionMap,function(b,a){_.isString(b)?D(a,function(){document.location.href=b}):_.isFunction(b)&&D(a,function(){b(a)})});D=null;_.each(A,function(b,a){d.setEventHandler(a,function(a,d){for(var c=b.length,e=0;e<c;++e)b[e](a,d)})});A=null}else i.handleLoadError_(this,c)};f.prototype.playLWF=function(d,f){var c=d.getAttribute("data-lwf-setting"),c=c?JSON.parse(c):
{};s=c.resizeMode||s;var i;i=a.LWF;if(h){if(c.renderer&&h!==c.renderer)throw Error("cannot use multiple renderer! LWF has been initialized for "+h+" renderer.");}else if(h=c.renderer||a.Utility.getRenderer(),"canvas"===h?h="useCanvasRenderer":"webkitcss"===h?h="useWebkitCSSRenderer":"webgl"===h&&(h="useWebGLRenderer"),h.match(/use.+Renderer/i))i[h]();else throw Error("Renderer parameters are not properly set");i=i.ResourceCache.get();var b=_.isObject(a.lwfDefaultParam)?_.clone(a.lwfDefaultParam):
{};b.debug=b.debug?!0:!1;b.onload=this.onLoad;_.isUndefined(c.backgroundColor)?b.useBackgroundColor=!0:b.setBackgroundColor=c.backgroundColor;b.fitForHeight=!1;b.fitForWidth=!1;b[s]=!0;b.worker=r;b.imageVersion=d.getAttribute("data-lwf-image_version");k&&(/ SC-0/.test(j)&&"useWebkitCSSRenderer"===h)&&(b.quirkyClearRect=!0);k&&(b.use3D=!1);b.privateData={};b.pos=null;b.imageMap={};b.soundMap={};b.pageTransitionMap={};b.buttonEventMap={};b.fsCommandMap={};b.handler={};b.callback={};b.lwfMap=null;for(c=
0;c<d.attributes.length;c++){var g=d.attributes[c];if(g.name&&0===g.name.indexOf("data-lwf-")){var e=g.name.slice(9),e=e.replace(/_./g,function(b){return b.charAt(1).toUpperCase()});if("setting"!==e){g=g.value;try{"{"===g.charAt(0)&&(g=JSON.parse(g))}catch(B){}b[e]=g}}}2==a.devicePixelRatio&&b.useHighResImage&&(b.imageSuffix="_@2x");b.hasOwnProperty("lwf")||(c=d.getAttribute("data-lwf"),_.isString(c)&&(b.lwf=c));b.hasOwnProperty("name")&&(b.lwf=b.name);_.isObject(f)&&_.extend(b,f);0<this.initializeHooks.length&&
_.each(this.initializeHooks,_.bind(function(a){if(_.isFunction(a)){a=a.call(this,d);for(var c in a)a.hasOwnProperty(c)&&_.extend(b[c],a[c])}},this));this.initializeHooks=[];if(!b.hasOwnProperty("lwf"))throw Error("[LWF] no LWF input");c={};c.debugInfoElementId=++x;c.setting=b;c.resizeMode=s;c.loader=this;c.debug=!1;c.soundMap=null;c.pageTransitionMap=null;c.buttonEventMap=null;c.fsCommandMap=null;c.handler=null;c.callback=null;c.stageEventReceiver=null;c.lwfMap=null;d.getAttribute("data-debug")&&
(b.privateData.debug=!0);c.debug=b.debug?!0:!1;delete b.debug;b.privateData.hasOwnProperty("lwfLoader")||(b.privateData.lwfLoader=this);b.imageMap=this.getImageMapper_(b.imageMap,b.imageVersion);_.isEmpty(b.soundMap)||(c.soundMap=b.soundMap);delete b.soundMap;_.isObject(b.pageTransitionMap)&&(c.pageTransitionMap=b.pageTransitionMap);delete b.pageTransitionMap;c.buttonEventMap=b.buttonEventMap;delete b.buttonEventMap;_.isEmpty(b.fsCommandMap)||(c.fsCommandMap=b.fsCommandMap);delete b.fsCommandMap;
_.isEmpty(b.handler)||(c.handler=b.handler);delete b.handler;c.callback=b.callback;delete b.callback;c.lwfMap=b.lwfMap;delete b.lwfMap;this.isLwfsEnvironment_()&&(e=b.prefix?b.prefix+b.lwf:b.lwf,b.prefix=e.slice(0,e.lastIndexOf("/")+1),delete b.imagePrefix,b.lwf=e.slice(e.lastIndexOf("/")+1));e={position:"absolute",top:0,left:0};_.extend(e,b.pos);delete b.pos;if("static"===d.style.position||""===d.style.position)d.style.position="relative";g=q(h);g.style.position=e.position;g.style.top=e.top+"px";
g.style.left=e.left+"px";g.style.zIndex=d.style.zIndex+1;d.appendChild(g);var p=null;m?(p=document.createElement("div"),p.style.position="absolute",p.style.top=e.top+"px",p.style.left=e.left+"px",p.style.zIndex=g.style.zIndex+1,d.appendChild(p)):p=g;b.stage=g;c.stageEventReceiver=p;if(this.debug||c.debug)g=document.createElement("div"),g.id="lwf_info"+x,g.style.position=e.position,g.style.top=e.top+"px",g.style.left=e.left+"px",g.style.color="white",g.style.zIndex=1E4,d.appendChild(g);if(b.lwf){c.useLwfJs=
/\.lwf.js(\?.*)?$/.test(b.lwf);if(b.hasOwnProperty("_loaderData"))throw Error("cannot use '_loaderData' property that used by lwf-loader!");b.privateData._loaderData=c;i.loadLWF(b)}else console.error("[LWF] no LWF input")};f.prototype.requestLWF_=function(a,f,c,i,b){var g={};if(this.isLwfsEnvironment_()){var e=_.clone(window.testlwf_settings);e.prefix?g=e.prefix+f+"/_/":(g=document.location.pathname,g=g.replace(a.name,f),g=g.slice(0,g.lastIndexOf("/")+1)+"_/");e.prefix=g;delete e.imagePrefix;g=this.getLwfPath_(f);
if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;e.lwf=g;k&&(e.lwf+=".js");e.parentLWF=a;e.stage=a.stage;e.worker=r;e.active=!1;c&&(e.imageMap=this.getImageMapper_(c,e.imageVersion));i&&(e.privateData=i);e.onload=function(a){var c=this.privateData.lwfLoader;return!a?(c.handleLoadError_(this),b(this.error,a)):b(null,a)}}else{e=a.privateData;if("undefined"===typeof e)return console.error("[LWF] Parent private data is not found"),b("no parents data found",null),null;var h=
_.clone(e._loaderData);if("undefined"===typeof h)return console.error("[LWF] Parent Loader data is not found"),b("no loader parameters to inherit"),null;e=_.clone(h.setting);e.fitForHeight=e.fitForWidth=!1;h.setting=e;g=null;try{g=this.getLwfMapper_(h)(f)}catch(j){this.handleException_(j,h)}if(!g)return console.error("[LWF] no LWF input"),b("no LWF input",null),null;e.lwf=g;h.useLwfJs&&(e.lwf+=".js");e.parentLWF=a;e.stage=a.stage;e.worker=r;e.active=!1;c&&(e.imageMap=this.getImageMapper_(c,e.imageVersion));
i&&(i._loaderData=h,e.privateData=i);e.onload=function(a){var c=h.loader;return!a?(c.handleLoadError_(this,h),b(this.error,a)):b(null,a)}}return e};f.prototype.requestLWF=function(a,f,c,h,b){a=this.requestLWF_(a,f,c,h,b);_.isNull(a)||this.requests.push(a)};f.prototype.loadLWFs=function(d){a.LWF.ResourceCache.get().loadLWFs(this.requests,d);this.requests=[]};f.prototype.loadLWF=function(d,f,c,h,b){d=this.requestLWF_(d,f,c,h,b);_.isNull(d)||a.LWF.ResourceCache.get().loadLWF(d)};a.LwfLoader=f;f.prototype.playLWF=
f.prototype.playLWF;f.prototype.loadLWF=f.prototype.loadLWF;f.prototype.addInitializeHook=f.prototype.addInitializeHook})(window);
